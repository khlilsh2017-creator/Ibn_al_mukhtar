<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Ù…ØªØ¬Ø± Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„Ù„Ø£Ø¯ÙˆØ§Øª</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

<style>
  :root {
    --aliexpress-red: #FF4747; 
    --aliexpress-orange: #FF8238;
    --bg-color: #f2f2f2;
    --card-bg: #ffffff;
    --text-color: #222;
    --nav-height: 60px;
    --total-header-height: 100px; 
  }

  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  body {
    margin: 0; background: var(--bg-color); color: var(--text-color);
    font-family: 'Tajawal', sans-serif;
    padding-bottom: 180px; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
    padding-top: var(--total-header-height);
  }

  /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
  header {
    position: fixed; top: 0; left: 0; right: 0;
    height: var(--total-header-height); 
    background: #fff;
    padding-top: 5px; 
    box-shadow: 0 1px 5px rgba(0,0,0,0.05);
    z-index: 100;
  }
  
  /* Ø§Ù„Ø¨Ø§Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø¨Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± */
  .top-bar {
    text-align: center;
    padding: 5px 15px 5px; 
    font-weight: 800;
    font-size: 16px;
    color: var(--aliexpress-red);
  }

  /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« */
  .search-container {
    width: 100%; 
    padding: 0 15px; 
    display: flex; align-items: center; justify-content: center;
  }
  .search-input-wrapper {
    width: 100%; background: #f5f5f5; border-radius: 99px;
    padding: 5px 15px; display: flex; align-items: center; gap: 8px;
    border: 1px solid #e0e0e0;
  }
  .search-input {
    width: 100%; background: transparent; border: none;
    padding: 8px 0; font-family: 'Tajawal', sans-serif;
    font-size: 14px; color: #333; outline: none;
  }
  .search-input::placeholder { color: #999; }

  /* Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª */
  .categories-wrapper {
    position: sticky; top: var(--total-header-height);
    background: #fff; z-index: 90; padding: 10px 10px;
    overflow-x: auto; white-space: nowrap; border-bottom: 1px solid #eee;
    -ms-overflow-style: none; scrollbar-width: none;
  }
  .categories-wrapper::-webkit-scrollbar { display: none; }
  
  .filter-btn {
    display: inline-block; padding: 6px 16px; margin-left: 5px;
    background: #f5f5f5; border: none; border-radius: 6px;
    font-size: 13px; font-weight: 600; color: #555; transition: 0.2s;
  }
  .filter-btn.active {
    background: #ffe6e6; color: var(--aliexpress-red); font-weight: 800;
  }

  /* Ø§Ù„Ø´Ø¨ÙƒØ© ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª */
  main { padding: 10px; min-height: 80vh; }
  .view-section { display: none; animation: fadeIn 0.3s ease; }
  .view-section.active { display: block; }
  .products-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }

  /* Ø§Ù„ÙƒØ§Ø±Øª */
  .card {
    background: var(--card-bg); border-radius: 8px; overflow: hidden;
    position: relative; box-shadow: none;
  }
  .card-slider { position: relative; width: 100%; padding-top: 100%; background: #fff; }
  .card-slider img {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    object-fit: cover; opacity: 0; transition: opacity 0.4s;
  }
  .card-slider img.active { opacity: 1; }

  .add-fab {
    position: absolute; bottom: -15px; left: 8px;
    width: 30px; height: 30px; background: #fff; border-radius: 50%;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15); display: flex; align-items: center; justify-content: center;
    color: var(--aliexpress-red); font-size: 20px; font-weight: bold; cursor: pointer; z-index: 2;
    border: 1px solid #eee;
  }

  .card-body { padding: 10px 8px; padding-top: 20px; }
  .name { 
    font-size: 13px; font-weight: 400; color: #333; 
    margin-bottom: 6px; height: 34px; overflow: hidden; line-height: 1.3;
    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
  }
  .price-area { display: flex; align-items: baseline; gap: 4px; flex-wrap: wrap; }
  .price { font-size: 17px; font-weight: 800; color: var(--aliexpress-red); }
  .currency { font-size: 11px; font-weight: 700; color: var(--aliexpress-red); }
  .old-price { font-size: 11px; text-decoration: line-through; color: #999; margin-right: 4px; }
  .discount-tag {
    background: #ffe6e6; color: var(--aliexpress-red);
    font-size: 9px; padding: 2px 4px; border-radius: 2px; font-weight: 700;
  }
  .extra-info { font-size: 10px; color: #777; margin-top: 4px; }

  /* Ø§Ù„Ø³Ù„Ø© */
  .cart-item {
    display: flex; align-items: center; gap: 10px; background: #fff;
    padding: 10px; margin-bottom: 10px; border-radius: 8px;
  }
  
  .shipping-box { background: #fff; padding: 12px; margin: 10px 0; border-radius: 8px; }
  .shipping-select {
    width: 100%; padding: 10px; margin-top: 5px;
    border: 1px solid #ddd; border-radius: 6px;
    background: #fff; font-family: 'Tajawal', sans-serif; font-size: 14px;
  }

  .cart-summary { background: #fff; padding: 15px; margin: 10px 0; border-radius: 8px; }
  .summary-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; color: #555; }
  .total-row {
    border-top: 1px solid #eee; padding-top: 10px; margin-top: 10px;
    display: flex; justify-content: space-between; align-items: center;
    font-weight: 800; font-size: 16px; color: #333;
  }
  .final-price { color: var(--aliexpress-red); font-size: 20px; }

  /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
  #checkoutActionButtons {
      position: fixed; 
      bottom: 70px; 
      left: 10px; 
      right: 10px; 
      z-index: 95;
      display: flex; 
      flex-direction: column; 
  }
  .checkout-btn {
    position: relative; 
    width: 100%;
    padding: 12px; border-radius: 99px; text-align: center; font-weight: bold; 
    font-size: 16px; border: none; margin-bottom: 10px;
  }
  #checkoutBtnWhatsapp { /* Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù‚Ø¯ÙŠÙ… */
    background: linear-gradient(90deg, #FF8238, #FF4747); 
    color: #fff; 
    box-shadow: 0 4px 10px rgba(255, 71, 71, 0.3); 
  }
  #checkoutBtnPage { /* Ø²Ø± Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
    background: #4CAF50; /* Ø£Ø®Ø¶Ø± */
    color: #fff; 
    box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
  }

  /* Ø§Ù„Ø¨Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠ */
  .bottom-nav {
    position: fixed; bottom: 0; left: 0; right: 0; height: 55px;
    background: #fff; display: flex; justify-content: space-around; align-items: center;
    border-top: 1px solid #eee; z-index: 100;
  }
  .nav-item {
    display: flex; flex-direction: column; align-items: center; gap: 3px;
    color: #777; font-size: 10px; font-weight: 500; cursor: pointer; padding: 5px; width: 50%;
  }
  .nav-item svg { width: 22px; height: 22px; fill: currentColor; }
  .nav-item.active { color: var(--aliexpress-red); font-weight: 700; }
  .nav-badge {
    position: absolute; top: 4px; margin-right: -12px; background: var(--aliexpress-red);
    color: #fff; font-size: 9px; padding: 2px 5px; border-radius: 10px; border: 1px solid #fff;
  }
  .empty-state { text-align: center; padding: 50px 20px; color: #999; grid-column: span 2;}
</style>
</head>
<body>

<header>
  <div class="top-bar">
    Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©
  </div>
  
  <div class="search-container">
    <div class="search-input-wrapper">
      <span style="font-size: 16px;">ğŸ”</span>
      <input type="text" class="search-input" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." oninput="handleSearch(this.value)">
    </div>
  </div>
</header>

<div class="categories-wrapper" id="categoriesBar">
  <div class="filter-btn active" onclick="filterProducts('all', this)">Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ù„Ùƒ</div>
  <div class="filter-btn" onclick="filterProducts('Ø£Ø¯ÙˆØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©', this)">ğŸ  Ø§Ù„Ù…Ù†Ø²Ù„</div>
  <div class="filter-btn" onclick="filterProducts('Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª', this)">âš¡ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</div>
</div>

<main>
  <div id="homeView" class="view-section active">
    <div id="productsGrid" class="products-grid"></div>
  </div>

  <div id="cartView" class="view-section">
    <h3 style="margin-top:0; font-size:16px;">Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h3>
    <div id="cartItems"></div>
    
    <div id="checkoutSection" style="display:none">
      <div class="shipping-box">
        <label style="font-weight:bold; font-size:13px;">ğŸ“ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙˆØµÙŠÙ„:</label>
        <select id="shippingSelect" class="shipping-select" onchange="renderCart()">
          <option value="1000">Ø¯Ø§Ø®Ù„ ØµÙ†Ø¹Ø§Ø¡ (+1,000 Ø±.ÙŠ)</option>
          <option value="2000">Ù…Ø­Ø§ÙØ¸Ø© Ø£Ø®Ø±Ù‰ (+2,000 Ø±.ÙŠ)</option>
        </select>
      </div>

      <div class="cart-summary">
        <div class="summary-row">
          <span>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</span>
          <span id="subTotalDisplay">0</span>
        </div>
        <div class="summary-row">
          <span>Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„:</span>
          <span id="shippingDisplay">0</span>
        </div>
        <div class="total-row">
          <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ:</span>
          <span class="final-price" id="finalTotalDisplay">0</span>
        </div>
      </div>
    </div>

    <div class="empty-state" id="emptyCartMsg" style="display:none">
      <div style="font-size:50px;margin-bottom:10px; opacity:0.3">ğŸ›’</div>
      Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³ÙˆÙ‚!
    </div>
  </div>
</main>

<div id="checkoutActionButtons" style="display:none">
    <button id="checkoutBtnWhatsapp" class="checkout-btn" onclick="sendCart()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
    <button id="checkoutBtnPage" class="checkout-btn new-page-btn" onclick="prepareAndRedirectToCheckout()">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Ù‹</button>
</div>

<div class="bottom-nav">
  <div class="nav-item active" onclick="switchTab('home')">
    <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
    <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
  </div>
  
  <div class="nav-item" onclick="switchTab('cart')" style="position:relative">
    <div class="nav-badge" id="cartBadge" style="display:none">0</div>
    <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
    <span>Ø§Ù„Ø³Ù„Ø©</span>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB5mEBB0plzw_d-gAth-TK0xR523IX6nGg",
    authDomain: "my-fils-575be.firebaseapp.com",
    projectId: "my-fils-575be",
    storageBucket: "my-fils-575be.firebasestorage.app",
    messagingSenderId: "670428095338",
    appId: "1:670428095338:web:75d4a577cc648c208d7b13"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const productsCol = collection(db, "products");

  async function fetchProducts() {
      const grid = document.getElementById("productsGrid");
      grid.innerHTML = "<div style='text-align:center; padding:20px; grid-column:span 2; color:#999'>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</div>";
      
      try {
          const snapshot = await getDocs(productsCol);
          let products = snapshot.docs.map(doc => {
              return { id: doc.id, ...doc.data() }; 
          });
          
          window.allProducts = products;
          
          if(window.renderProducts) window.renderProducts();
          
      } catch (error) {
          console.error(error);
          grid.innerHTML = "<div style='text-align:center; padding:20px; grid-column:span 2;'>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙØ§ÙŠØ±Ø¨ÙŠØ³.</div>";
      }
  }

  fetchProducts();
</script>

<script>
  const WHATSAPP = "967773266534";
  
  window.allProducts = []; 
  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  let currentFilter = "all";

  const grid = document.getElementById("productsGrid");
  const cartItemsContainer = document.getElementById("cartItems");
  const cartBadge = document.getElementById("cartBadge");
  const emptyCartMsg = document.getElementById("emptyCartMsg");
  const checkoutSection = document.getElementById("checkoutSection");
  const checkoutActionButtons = document.getElementById("checkoutActionButtons"); // Ø²Ø± Ø§Ù„Ø£ÙƒØ´Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯
  
  const subTotalDisplay = document.getElementById("subTotalDisplay");
  const shippingDisplay = document.getElementById("shippingDisplay");
  const finalTotalDisplay = document.getElementById("finalTotalDisplay");
  const shippingSelect = document.getElementById("shippingSelect");

  window.onpageshow = function(event) {
    if (event.persisted || performance.navigation.type == 2) {
       cart = JSON.parse(localStorage.getItem("cart")) || [];
       updateCartBadge();
    }
  };

  function switchTab(tab) {
    document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));

    if(tab === 'home') {
      document.getElementById('homeView').classList.add('active');
      document.querySelector('.nav-item:first-child').classList.add('active');
      renderProducts();
      cart = JSON.parse(localStorage.getItem("cart")) || [];
      updateCartBadge();
    } else {
      document.getElementById('cartView').classList.add('active');
      document.querySelector('.nav-item:last-child').classList.add('active');
      cart = JSON.parse(localStorage.getItem("cart")) || [];
      renderCart();
    }
    window.scrollTo(0,0);
  }

  function handleSearch(query) {
    if(!window.allProducts.length) return;
    if(!query) {
      renderProducts(); 
      return;
    }
    let filtered = window.allProducts.filter(p => p.name.includes(query));
    drawItems(filtered);
  }

  window.renderProducts = function() {
    let items = currentFilter === "all" ? window.allProducts : window.allProducts.filter(p => p.category === currentFilter);
    drawItems(items);
  }

  function filterProducts(cat, btn) {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentFilter = cat;
    document.getElementById('searchInput').value = "";
    renderProducts();
  }

  function getHashNumber(str) {
      let hash = 0;
      for (let i = 0; i < str.length; i++) {
          hash = str.charCodeAt(i) + ((hash << 5) - hash);
      }
      return Math.abs(hash);
  }

  function drawItems(items) {
    grid.innerHTML = "";

    if (!window.allProducts.length) return; 

    if (items.length === 0) {
        grid.innerHTML = `<div class="empty-state">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© ğŸ”</div>`;
        return;
    }

    items.forEach(p => {
      const card = document.createElement("div");
      card.className = "card";
      const imgs = Array.isArray(p.image) ? p.image : [p.image];
      let sliderImgs = "";
      imgs.forEach((img, i) => {
        sliderImgs += `<img class="${i === 0 ? 'active' : ''}" src="${img}">`;
      });

      let rawPrice = p.price.toString().replace(/[^0-9.]/g, '');
      let priceVal = parseFloat(rawPrice) || 0;
      let fakeOldPrice = Math.floor(priceVal * 1.3);
      
      let hash = getHashNumber(p.id.toString());
      let soldCount = (hash % 901) + 100;

      card.innerHTML = `
        <div class="card-slider" onclick="openProduct('${p.id}')">
          ${sliderImgs}
          <div class="add-fab" onclick="event.stopPropagation(); addToCart('${p.id}')">+</div>
        </div>
        <div class="card-body" onclick="openProduct('${p.id}')">
          <div class="name">${p.name}</div>
          <div class="price-area">
             <span class="currency">Ø±.ÙŠ</span>
             <span class="price">${priceVal.toLocaleString()}</span>
          </div>
          <div style="display:flex; align-items:center; margin-top:2px;">
             <span class="old-price">${fakeOldPrice.toLocaleString()} Ø±.ÙŠ</span>
             <span class="discount-tag">-30%</span>
          </div>
          <div class="extra-info">ØªÙ… Ø¨ÙŠØ¹ ${soldCount}+ Ù‚Ø·Ø¹Ø©</div>
        </div>
      `;
      grid.appendChild(card);
    });
    startSlider();
  }

  window.openProduct = function(id) {
     window.location.href = `product.html?id=${id}`;
  }

  window.addToCart = function(id) {
    cart = JSON.parse(localStorage.getItem("cart")) || [];
    let item = cart.find(p => p.id === id);
    if(item) {
      item.qty++;
    } else {
      const p = window.allProducts.find(p => p.id === id);
      if(p) {
        cart.push({id: p.id, name: p.name, price: p.price, qty: 1});
      }
    }
    localStorage.setItem("cart", JSON.stringify(cart));
    updateCartBadge();
    navigator.vibrate?.(50);
  }

  window.changeQty = function(id, delta) {
    let item = cart.find(i => i.id === id);
    if(!item) return;
    item.qty += delta;
    if(item.qty <= 0) cart = cart.filter(i => i.id !== id);
    localStorage.setItem("cart", JSON.stringify(cart));
    renderCart();
    updateCartBadge();
  }

  function updateCartBadge() {
    let total = cart.reduce((acc, item) => acc + item.qty, 0);
    cartBadge.style.display = total > 0 ? "block" : "none";
    cartBadge.textContent = total > 99 ? '99+' : total;
  }

  window.renderCart = function() {
    cartItemsContainer.innerHTML = "";
    if(cart.length === 0) {
      emptyCartMsg.style.display = "block";
      checkoutActionButtons.style.display = "none";
      checkoutSection.style.display = "none"; 
      return;
    }
    emptyCartMsg.style.display = "none";
    checkoutActionButtons.style.display = "flex";
    checkoutSection.style.display = "block"; 

    let productTotal = 0;
    
    cart.forEach(item => {
      let rawPrice = item.price.toString().replace(/[^0-9.]/g, ''); 
      let priceVal = parseFloat(rawPrice) || 0;
      productTotal += priceVal * item.qty;

      cartItemsContainer.innerHTML += `
        <div class="cart-item">
          <div class="cart-info">
            <div class="cart-title">${item.name}</div>
            <div class="cart-price">${item.price}</div>
          </div>
          <div class="qty-control">
            <button class="qty-btn" style="border:1px solid #ddd" onclick="changeQty('${item.id}', 1)">+</button>
            <span style="font-weight:bold">${item.qty}</span>
            <button class="qty-btn" style="border:1px solid #ddd" onclick="changeQty('${item.id}', -1)">-</button>
          </div>
        </div>
      `;
    });

    let shippingCost = parseInt(shippingSelect.value);
    let finalTotal = productTotal + shippingCost;

    subTotalDisplay.innerText = productTotal.toLocaleString() + " Ø±.ÙŠ";
    shippingDisplay.innerText = shippingCost.toLocaleString() + " Ø±.ÙŠ";
    finalTotalDisplay.innerText = finalTotal.toLocaleString() + " Ø±.ÙŠ";
  }

  window.sendCart = function() {
    if(cart.length === 0) return;
    
    let msg = "Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ÙŠØ¯ Ø·Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:\n\n";
    let productTotal = 0;

    cart.forEach((i, idx) => {
      let rawPrice = i.price.toString().replace(/[^0-9.]/g, '');
      let priceVal = parseFloat(rawPrice) || 0;
      productTotal += priceVal * i.qty;
      msg += `${idx+1}. ${i.name} (Ø¹Ø¯Ø¯ ${i.qty})\n`;
    });

    let shippingCost = parseInt(shippingSelect.value);
    let shippingLocation = shippingSelect.options[shippingSelect.selectedIndex].text;
    let finalTotal = productTotal + shippingCost;

    msg += `\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
    msg += `ğŸ“ *Ø§Ù„ØªÙˆØµÙŠÙ„:* ${shippingLocation}\n`;
    msg += `ğŸ’° *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${finalTotal.toLocaleString()} Ø±.ÙŠ*`;

    window.open(`https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`);
  }
  
  // ğŸ”¥ Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹
  window.prepareAndRedirectToCheckout = function() {
      if(cart.length === 0) return;
      
      let productTotal = 0;
      cart.forEach(item => {
          let rawPrice = item.price.toString().replace(/[^0-9.]/g, ''); 
          productTotal += (parseFloat(rawPrice) || 0) * item.qty;
      });

      let shippingCost = parseInt(shippingSelect.value);
      let finalTotal = productTotal + shippingCost;
      let shippingLocation = shippingSelect.options[shippingSelect.selectedIndex].text;
      
      // Ø­ÙØ¸ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ù„Ù†Ù‚Ù„Ù‡ Ù„ØµÙØ­Ø© checkout
      localStorage.setItem("checkoutSummary", JSON.stringify({
          subTotal: productTotal,
          finalTotal: finalTotal,
          shipping: {
              cost: shippingCost,
              location: shippingLocation
          }
      }));
      
      // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹
      window.location.href = 'checkout.html';
  }

  function startSlider() {
    document.querySelectorAll(".card-slider").forEach(slider => {
      let imgs = slider.querySelectorAll("img");
      if(imgs.length <= 1) return;
      let index = 0;
      setInterval(() => {
        imgs[index].classList.remove("active");
        index = (index + 1) % imgs.length;
        imgs[index].classList.add("active");
      }, 3000);
    });
  }

  updateCartBadge();
</script>

</body>
</html>
