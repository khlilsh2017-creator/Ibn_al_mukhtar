<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://www.gstatic.com">
<link rel="preconnect" href="https://firestore.googleapis.com">

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#007AFF">

<style>
  :root{ --main-color: #007AFF; --secondary-color: #FF8C00; --bg-color: #f2f2f2; --card-bg: #ffffff; --text-color: #222; --total-header-height: 210px; }
  *{ box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  html,body{ height:100%; margin:0; font-family:'Tajawal',sans-serif; }
  body{ background:var(--bg-color); color:var(--text-color); padding-top:var(--total-header-height); padding-bottom:260px; transition: background 0.25s; }

  /* Header Styles */
  header{ position:fixed; inset:0 0 auto 0; height:var(--total-header-height); background: rgba(255,255,255,0.95); backdrop-filter: blur(5px); padding-top:5px; box-shadow: 0 1px 5px rgba(0,0,0,0.05); z-index:100; transition: transform 0.28s; }
  .header-hidden{ transform: translateY(-100%); box-shadow:none; }
  .top-bar{ height:130px; display:flex; justify-content:center; align-items:center; }
  .store-logo{ height:110px; object-fit:contain; }
  
  /* Buttons */
  #darkToggle, #currencyToggle{ position:absolute; top:12px; z-index:120; padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:700; border:0; }
  #darkToggle{ left:12px; background: rgba(0,0,0,0.06); }
  #currencyToggle{ right:12px; background: rgba(0,122,255,0.1); color: var(--main-color); border:1px solid rgba(0,122,255,0.2); }

  /* Search */
  .search-container{ width:100%; display:flex; justify-content:center; padding:6px 12px; }
  .search-input-wrapper{ width:100%; max-width:980px; background:#f5f5f5; border-radius:99px; padding:6px 12px; display:flex; align-items:center; gap:8px; border:1px solid #eee; }
  .search-input{ width:100%; background:transparent; border:0; outline:none; font-size:14px; padding:8px 0; }
  
  /* Categories */
  .categories-wrapper{ padding:10px; overflow-x:auto; white-space:nowrap; border-top:1px solid #f0f0f0; }
  .categories-wrapper::-webkit-scrollbar{ display:none; }
  .filter-btn{ display:inline-block; padding:7px 16px; margin-left:8px; background:#f5f5f5; border-radius:7px; border:0; font-weight:600; cursor:pointer; }
  .filter-btn.active{ background:#e6f0ff; color:var(--main-color); }

  /* Grid & Cards */
  main{ padding:12px; min-height:60vh; max-width:1100px; margin:0 auto; }
  .products-grid{ display:grid; grid-template-columns: repeat(2, 1fr); gap:10px; }
  .card{ background:var(--card-bg); border-radius:10px; overflow:hidden; position:relative; box-shadow:0 1px 4px rgba(0,0,0,0.03); }
  .card-slider{ position:relative; width:100%; padding-top:100%; background:#fff; overflow:hidden; }
  .card-slider img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; opacity:0; transition:opacity .45s; }
  .card-slider img.active{ opacity:1; }
  .add-fab{ position:absolute; bottom:-15px; left:10px; width:34px; height:34px; background:#fff; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:18px; color:var(--main-color); box-shadow:0 4px 12px rgba(0,0,0,0.12); z-index:5; cursor:pointer; }
  .card-body{ padding:12px 10px 10px; padding-top:22px; }
  .name{ font-size:13px; color:#222; height:34px; overflow:hidden; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; }
  .price{ font-size:17px; font-weight:800; color:#FF0000; }
  .currency{ font-size:11px; font-weight:700; color:#FF0000; }
  .old-price{ font-size:11px; text-decoration:line-through; color:#999; margin-right:6px; }
  .action-btns-wrapper{ margin-top:8px; display:flex; gap:8px; }
  .action-btns-wrapper button{ padding:6px!important; font-size:11px!important; font-weight:600!important; border-radius:8px; flex:1; cursor:pointer; border:0; }

  /* ğŸ”¥ Skeleton Loading Animation (Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠØ©) ğŸ”¥ */
  .skeleton { background: #eee; background: linear-gradient(110deg, #ececec 8%, #f5f5f5 18%, #ececec 33%); background-size: 200% 100%; animation: 1.5s shine linear infinite; border-radius: 8px; }
  @keyframes shine { to { background-position-x: -200%; } }
  .sk-img { width: 100%; padding-top: 100%; position: relative; }
  .sk-line { height: 14px; margin: 8px 0; width: 80%; }
  .sk-line.short { width: 40%; }
  
  /* Bottom Nav */
  .bottom-nav{ position:fixed; bottom:0; left:0; right:0; background:#fff; display:flex; border-top:1px solid #eee; z-index:100; transition: height 0.3s; }
  .nav-home-mode{ height:55px; } .nav-cart-mode{ height:120px; align-items:flex-start; }
  .nav-item{ display:flex; flex-direction:column; align-items:center; width:50%; padding:6px 0; color:#777; font-size:10px; cursor:pointer; }
  .nav-item.active{ color:var(--main-color); font-weight:700; }
  
  /* Cart & Others */
  .view-section{ display:none; } .view-section.active{ display:block; }
  #quickView{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.45); z-index:300; padding:16px; }
  #quickViewBox{ background:#fff; width:100%; max-width:440px; border-radius:12px; overflow:hidden; }
  
  /* Dark Mode */
  .dark body{ background:#0f1113; color:#e6e6e6; }
  .dark header{ background:rgba(0,0,0,0.8); }
  .dark .card{ background:#111214; }
  .dark .name{ color:#FF8C00; }
  .dark .skeleton{ background: linear-gradient(110deg, #1f2125 8%, #2a2c30 18%, #1f2125 33%); }

  @media(min-width:800px){ .products-grid{ grid-template-columns: repeat(4, 1fr); } }
</style>
</head>
<body>

<header>
  <button id="darkToggle">ğŸŒ™</button>
  <button id="currencyToggle" onclick="toggleCurrency()">Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ</button> 
  <div class="top-bar"><img src="logo.png" class="store-logo" loading="lazy"></div>
  <div class="search-container">
    <div class="search-input-wrapper">
      <span>ğŸ”</span>
      <input id="searchInput" class="search-input" placeholder="Ø§Ø¨Ø­Ø«..." oninput="handleSearch(this.value)" />
      <button id="clearSearch" style="display:none;border:0;background:none;cursor:pointer;">âœ–</button>
    </div>
  </div>
  <div class="categories-wrapper" id="categoriesBar"></div>
</header>

<main>
  <div id="homeView" class="view-section active">
    <div id="productsGrid" class="products-grid">
      <div class="card"><div class="sk-img skeleton"></div><div class="card-body"><div class="sk-line skeleton"></div><div class="sk-line short skeleton"></div></div></div>
      <div class="card"><div class="sk-img skeleton"></div><div class="card-body"><div class="sk-line skeleton"></div><div class="sk-line short skeleton"></div></div></div>
      <div class="card"><div class="sk-img skeleton"></div><div class="card-body"><div class="sk-line skeleton"></div><div class="sk-line short skeleton"></div></div></div>
      <div class="card"><div class="sk-img skeleton"></div><div class="card-body"><div class="sk-line skeleton"></div><div class="sk-line short skeleton"></div></div></div>
    </div>
  </div>

  <div id="cartView" class="view-section">
     <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
        <button onclick="switchTab('home')" style="background:none; border:0; font-weight:bold; cursor:pointer;">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
        <button onclick="clearCart()" style="background:none; border:0; color:var(--danger); font-weight:bold; cursor:pointer;">ğŸ—‘ï¸ ØªÙØ±ÙŠØº</button>
     </div>
     <div id="cartItems"></div>
     <div id="checkoutSection" style="display:none; background:#fff; padding:10px; border-radius:8px; margin-top:10px;">
        <label>ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹:</label>
        <select id="shippingSelect" style="width:100%; padding:8px; margin:5px 0;" onchange="renderCart()">
          <option value="1000">Ø¯Ø§Ø®Ù„ ØµÙ†Ø¹Ø§Ø¡ (+1000)</option>
          <option value="2000">Ù…Ø­Ø§ÙØ¸Ø© Ø£Ø®Ø±Ù‰ (+2000)</option>
        </select>
        <div style="border-top:1px solid #eee; margin-top:10px; padding-top:10px; display:flex; justify-content:space-between; font-weight:bold;">
          <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span><span id="finalTotalDisplay" style="color:#FF8C00">0</span>
        </div>
     </div>
     <div class="empty-state" id="emptyCartMsg" style="display:none; text-align:center; padding:40px;">ğŸ›’ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>
  </div>
</main>

<div id="quickView" onclick="if(event.target.id==='quickView')closeQuickView()"><div id="quickViewBox"></div></div>

<div class="bottom-nav nav-home-mode">
  <div id="homeNavBarContent" style="display:flex; width:100%;">
    <div class="nav-item active" onclick="switchTab('home')"><span>ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></div>
    <div id="installAppBtn" class="nav-item" style="display:none;" onclick="promptInstall()"><span>ğŸ“² ØªØ«Ø¨ÙŠØª</span></div>
    <div class="nav-item" onclick="switchTab('cart')">
      <span id="cartBadge" style="background:red; color:#fff; font-size:9px; padding:2px 5px; border-radius:10px; display:none;">0</span>
      <span>ğŸ›’ Ø§Ù„Ø³Ù„Ø©</span>
    </div>
  </div>
  <div id="cartActionBarContent" style="display:none; width:100%; padding:10px; gap:5px;">
    <button onclick="sendCart()" style="flex:1; background:orange; color:#fff; border:0; padding:10px; border-radius:20px;">ÙˆØ§ØªØ³Ø§Ø¨</button>
    <button onclick="prepareAndRedirectToCheckout()" style="flex:1; background:green; color:#fff; border:0; padding:10px; border-radius:20px;">Ø´Ø±Ø§Ø¡</button>
  </div>
</div>

<script>
    // 1. Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙˆØ¹Ø±Ø¶Ù‡Ø§ ÙÙˆØ±Ø§Ù‹
    try {
        const cachedProducts = localStorage.getItem('local_products_cache');
        if (cachedProducts) {
            window.allProducts = JSON.parse(cachedProducts);
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙˆØ±Ø§Ù‹ (Ø¨Ø¯ÙˆÙ† Ø§Ù†ØªØ¸Ø§Ø± Ø£ÙŠ Ø´Ø¨ÙƒØ©)
            window.addEventListener('DOMContentLoaded', () => {
                if(window.renderProducts) window.renderProducts(window.allProducts.slice(0, 6)); // Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 6
                setTimeout(() => { if(window.renderProducts) window.renderProducts(window.allProducts); }, 100);
            });
        }
    } catch(e) { console.log('No cache'); }
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getFirestore, collection, getDocs, initializeFirestore, persistentLocalCache, persistentMultipleTabManager } 
  from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB5mEBB0plplzw_d-gAth-TK0xR523IX6nGg", 
    authDomain: "my-fils-575be.firebaseapp.com",
    projectId: "my-fils-575be",
    storageBucket: "my-fils-575be.firebasestorage.app",
    messagingSenderId: "670428095338",
    appId: "1:670428095338:web:75d4a577cc648c208d7b13"
  };

  const app = initializeApp(firebaseConfig);
  const db = initializeFirestore(app, { localCache: persistentLocalCache({ tabManager: persistentMultipleTabManager() }) });
  const productsCol = collection(db, "products");
  const categoriesCol = collection(db, "categories");
  
  let imgObserver = null; 

  async function fetchCategories() {
      const bar = document.getElementById('categoriesBar');
      if(bar.children.length > 0) return; // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ù„Ø§ ØªØ¹ÙŠØ¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
      
      const allBtn = document.createElement('button');
      allBtn.className = 'filter-btn active'; allBtn.textContent = 'Ø§Ù„ÙƒÙ„';
      allBtn.onclick = () => window.filterProducts('all', allBtn);
      bar.appendChild(allBtn);

      try {
          const snapshot = await getDocs(categoriesCol);
          snapshot.docs.forEach(doc => {
              const btn = document.createElement('button');
              btn.className = 'filter-btn'; btn.textContent = doc.data().name;
              btn.onclick = (e) => window.filterProducts(doc.data().name, e.target);
              bar.appendChild(btn);
          });
      } catch(e){}
  }

  window.fetchProducts = async function(){
    fetchCategories();
    
    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ÙƒØ§Ø´ØŒ Ù†Ø¹Ø±Ø¶ Skeleton
    if(!window.allProducts || window.allProducts.length === 0) {
       // Ø§Ù„Ù€ Skeleton Ù…ÙˆØ¬ÙˆØ¯ Ø£ØµÙ„Ø§Ù‹ ÙÙŠ HTML
    }

    try{
      const snapshot = await getDocs(productsCol);
      const products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      
      // Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ localStorage Ù„Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
      localStorage.setItem('local_products_cache', JSON.stringify(products));

      window.allProducts = products;
      window.renderProducts(products); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
      setTimeout(window.initObservers, 500);
    }catch(err){ console.error(err); }
  }

  function initObservers(){
      if (imgObserver) imgObserver.disconnect();
      imgObserver = new IntersectionObserver((entries)=>{
        entries.forEach(entry=>{
          if(entry.isIntersecting){
            const img = entry.target;
            if (img.dataset.src) { img.src = img.dataset.src; img.removeAttribute('data-src'); }
            imgObserver.unobserve(img);
          }
        });
      }, { rootMargin: '0px 0px 100px 0px' }); 
      document.querySelectorAll('img[data-src]').forEach(img => imgObserver.observe(img));
  }
  window.initObservers = initObservers;

  // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¬Ù„Ø¨ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ØªÙ…Ø§Ù…Ø§Ù‹
  window.addEventListener('load', window.fetchProducts);
</script>

<script>
  /* ================= Logic (Optimized) ================= */
  const SAR_RATE = 140; 
  window.allProducts = window.allProducts || [];
  let cart = JSON.parse(localStorage.getItem("cart")||"[]") || [];
  let currentCurrency = localStorage.getItem('currentCurrency') || 'YER'; 
  const grid = document.getElementById("productsGrid");

  /* --- Draw Items --- */
  window.renderProducts = function(itemsToDraw = null){
    const items = itemsToDraw || (window.allProducts || []);
    if(!items.length) return;

    grid.innerHTML = "";
    items.forEach((p) => { 
        // Ø¶ØºØ· Ø§Ù„ØµÙˆØ±
        const imgs = Array.isArray(p.image) ? p.image : [p.image || 'placeholder.png'];
        let sliderHTML = "";
        imgs.forEach((src, i) => {
            let s = src.includes('firebase') ? src + '?alt=media&width=300' : src;
            sliderHTML += i < 6 ? `<img src="${s}" ${i===0?'class="active"':""}>` : `<img data-src="${s}" ${i===0?'class="active"':""}>`;
        });

        // Ø§Ù„Ø³Ø¹Ø±
        let price = parseFloat((p.price||"").toString().replace(/[^0-9.]/g, '')) || 0;
        let dPrice = currentCurrency === 'SAR' ? Math.ceil(price / SAR_RATE) : price;
        let sym = currentCurrency === 'SAR' ? 'Ø±.Ø³' : 'Ø±.ÙŠ';

        const div = document.createElement('div'); div.className = 'card';
        div.innerHTML = `
            <div class="card-slider manual-slider" ontouchstart="sliderTouch(this)" onmouseenter="sliderHover(this)" onmouseleave="sliderLeave(this)">
                ${sliderHTML}
                <div class="add-fab" onclick="addToCart('${p.id}');event.stopPropagation()">+</div>
            </div>
            <div class="card-body" onclick="openProduct('${p.id}')">
                <div class="name">${p.name}</div>
                <div style="display:flex;gap:5px;align-items:baseline"><span class="currency">${sym}</span><span class="price">${dPrice.toLocaleString()}</span></div>
                <div class="action-btns-wrapper">
                    <button style="border:1px solid #eee;background:#fff" onclick="event.stopPropagation();quickView('${p.id}')">ğŸ‘ï¸ Ù†Ø¸Ø±Ø©</button>
                    <button style="background:var(--main-color);color:#fff" onclick="event.stopPropagation();addToCart('${p.id}')">Ø£Ø¶Ù</button>
                </div>
            </div>`;
        grid.appendChild(div);
    });
    // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ³ÙˆÙ„
    if(window.initObservers) window.initObservers();
  };

  /* --- Manual Slider Logic (Inline for speed) --- */
  window.sliderTouch = function(el){ nextSlide(el); }
  window.sliderHover = function(el){ el.tm = setInterval(()=>nextSlide(el), 600); }
  window.sliderLeave = function(el){ clearInterval(el.tm); resetSlide(el); }
  function nextSlide(el){
      const imgs = el.querySelectorAll('img'); if(imgs.length<2)return;
      let active = 0; imgs.forEach((img,i)=>{ if(img.classList.contains('active')) active=i; img.classList.remove('active'); });
      imgs[(active+1)%imgs.length].classList.add('active');
  }
  function resetSlide(el){
      const imgs = el.querySelectorAll('img'); if(imgs.length<2)return;
      imgs.forEach(i=>i.classList.remove('active')); imgs[0].classList.add('active');
  }

  /* --- Cart & UI Helpers --- */
  window.addToCart = function(id){
      let item = cart.find(x=>x.id===id);
      if(item) item.qty++; 
      else { const p=window.allProducts.find(x=>x.id===id); if(p) cart.push({id:p.id, name:p.name, price:p.price, qty:1}); }
      saveCart(); updateCartBadge();
  }
  function saveCart(){ localStorage.setItem("cart", JSON.stringify(cart)); }
  function updateCartBadge(){ 
      const t = cart.reduce((a,b)=>a+(b.qty||0),0); 
      document.getElementById('cartBadge').innerText = t > 99 ? '99+' : t;
      document.getElementById('cartBadge').style.display = t ? 'inline' : 'none';
  }
  window.switchTab = function(t){
      document.querySelectorAll('.view-section').forEach(x=>x.classList.remove('active'));
      document.getElementById(t+'View').classList.add('active');
      const nav = document.querySelector('.bottom-nav');
      if(t==='home'){ 
          nav.className='bottom-nav nav-home-mode'; 
          document.getElementById('homeNavBarContent').style.display='flex';
          document.getElementById('cartActionBarContent').style.display='none';
          document.body.style.paddingBottom='260px';
          document.querySelector('header').style.display='block';
      } else { 
          renderCart(); nav.className='bottom-nav nav-cart-mode';
          document.getElementById('homeNavBarContent').style.display='none';
          document.getElementById('cartActionBarContent').style.display='flex';
          document.body.style.paddingBottom='140px';
          document.querySelector('header').style.display='none';
      }
      window.scrollTo(0,0);
  }
  
  window.renderCart = function(){
      const div = document.getElementById('cartItems'); div.innerHTML='';
      let total = 0;
      if(!cart.length){ document.getElementById('emptyCartMsg').style.display='block'; document.getElementById('checkoutSection').style.display='none'; return;}
      
      document.getElementById('emptyCartMsg').style.display='none';
      document.getElementById('checkoutSection').style.display='block';

      cart.forEach(i=>{
          let price = parseFloat((i.price||"0").replace(/[^0-9.]/g,''));
          total += price * i.qty;
          div.innerHTML += `<div style="display:flex;justify-content:space-between;background:#fff;padding:10px;margin-bottom:5px;border-radius:8px">
              <div><b>${i.name}</b><br><small>${price} Ø±.ÙŠ</small></div>
              <div style="display:flex;gap:10px;align-items:center">
                  <button onclick="changeQty('${i.id}',1)" style="padding:2px 8px">+</button>
                  <b>${i.qty}</b>
                  <button onclick="changeQty('${i.id}',-1)" style="padding:2px 8px">-</button>
              </div>
          </div>`;
      });
      
      // Totals
      let ship = parseInt(document.getElementById('shippingSelect').value);
      let isSar = currentCurrency === 'SAR';
      let dTotal = isSar ? Math.ceil(total/SAR_RATE) : total;
      let dShip = isSar ? Math.ceil(ship/SAR_RATE) : ship;
      let sym = isSar ? 'Ø±.Ø³' : 'Ø±.ÙŠ';
      document.getElementById('finalTotalDisplay').innerText = (dTotal + dShip).toLocaleString() + ' ' + sym;
  }
  
  window.changeQty = function(id,v){
      let i = cart.find(x=>x.id===id); if(i){ i.qty+=v; if(i.qty<=0) cart=cart.filter(x=>x.id!==id); saveCart(); renderCart(); updateCartBadge(); }
  }
  window.clearCart = function(){ if(confirm('Ø­Ø°ÙØŸ')){cart=[];saveCart();renderCart();updateCartBadge();} }
  
  /* --- Quick View --- */
  window.quickView = function(id){
      const p = window.allProducts.find(x=>x.id===id); if(!p)return;
      const img = Array.isArray(p.image) ? p.image[0] : (p.image || 'placeholder.png');
      document.getElementById('quickViewBox').innerHTML = `<img src="${img}" style="width:100%"><div style="padding:15px"><h3>${p.name}</h3><button onclick="addToCart('${p.id}');closeQuickView()" style="width:100%;padding:10px;background:#007AFF;color:#fff;border:0;border-radius:10px">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button></div>`;
      document.getElementById('quickView').style.display='flex';
  }
  window.closeQuickView = function(){ document.getElementById('quickView').style.display='none'; }

  window.toggleCurrency = function(){
      currentCurrency = currentCurrency === 'YER' ? 'SAR' : 'YER';
      localStorage.setItem('currentCurrency', currentCurrency);
      document.getElementById('currencyToggle').innerText = currentCurrency === 'YER' ? 'Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ' : 'Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ';
      renderProducts();
  }
  
  // Init
  updateCartBadge();
  document.getElementById('currencyToggle').innerText = currentCurrency === 'YER' ? 'Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ' : 'Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ';
</script>

</body>
</html>
