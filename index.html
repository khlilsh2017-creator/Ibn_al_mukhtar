<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="192x192" href="/images/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/icon-16x16.png">
    
    <meta name="description" content="Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ© - Ø£ÙØ¶Ù„ Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ© Ø¨Ø£Ø³Ø¹Ø§Ø± Ù…Ù†Ø§Ø³Ø¨Ø©">
    <meta name="theme-color" content="#001F3F"> 
    <script type="application/ld+json">
        {
            "@context": "https://schema.org/",
            "@type": "Store",
            "name": "Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©",
            "url": "https://yourwebsite.com",
            "image": "logo.png"
        }
    </script>
    <style>
        :root {
            /* ğŸ”¥ğŸ”¥ Ø£Ù„ÙˆØ§Ù† Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø± ğŸ”¥ğŸ”¥ */
            --main-color: #001F3F;      /* ÙƒØ­Ù„ÙŠ */
            --secondary-color: #FF8C00; /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
            --bg-color: #ffffff;
            --card-bg: #ffffff;
            --text-color: #001F3F;
            
            /* ğŸ”¥ğŸ”¥ ØªØµØºÙŠØ± Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù‡ÙŠØ¯Ø± ğŸ”¥ğŸ”¥ */
            --nav-height: 60px;
            --total-header-height: 145px; 
            
            --radius: 12px;
            --danger: #ff4d4d;
        }

        /* ============ Reset & Base ============ */
        *{
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        html,body{
            height:100%;
            margin:0;
            font-family:'Tajawal',sans-serif;
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
        }
        body{
            background:var(--bg-color);
            color:var(--text-color);
            padding-top:var(--total-header-height);
            /* ğŸ”¥ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù€ padding-bottom Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ø¨Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠ Ø§Ù„Ù…Ø¶ØºÙˆØ· ğŸ”¥ */
            padding-bottom:100px; 
            transition: background 0.3s, color 0.3s;
        }

        /* ============ Header (ØªØµØºÙŠØ± Ø§Ù„Ø­Ø¬Ù… ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†) ============ */
        header{
            position:fixed;
            inset:0 0 auto 0;
            height:var(--total-header-height);
            background: rgba(255,255,255,0.98);
            backdrop-filter: blur(8px);
            padding-top:5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            z-index:100;
            transition: transform 0.3s ease, box-shadow 0.2s;
        }
        .header-hidden{
            transform: translateY(-100%);
            box-shadow:none;
        }
        .top-bar{
            height: 65px; /* Ø§Ø±ØªÙØ§Ø¹ ØµØºÙŠØ± */
            display:flex;
            justify-content:center;
            align-items:center;
            padding: 0 10px;
            position: relative;
        }
        .store-logo{
            height: 50px; /* Ø´Ø¹Ø§Ø± ØµØºÙŠØ± */
            width: auto;
            object-fit:contain;
            display:block;
        }
        /* Ø²Ø± Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
        #darkToggle, #currencyToggle {
            position:absolute; top: 18px;
            background: #f0f0f0; color: var(--main-color);
            border: 1px solid #eee; padding: 6px 12px;
            border-radius: 20px; cursor:pointer; font-weight:700; font-size: 11px;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #darkToggle { left: 15px; }
        /* Ø²Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø© ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± */
        #currencyToggle{
            right:15px;
            background: rgba(0, 31, 63, 0.05); /* ÙƒØ­Ù„ÙŠ Ø´ÙØ§Ù */
            color: var(--main-color);
            border:1px solid rgba(0, 31, 63, 0.1);
        }
        /* Ø§Ù„Ø¨Ø­Ø« */
        .search-container{
            width:100%;
            display:flex;
            justify-content:center;
            padding: 5px 15px;
        }
        .search-input-wrapper{
            width:100%;
            max-width:980px;
            background:#f8f9fa;
            border-radius:99px;
            padding:6px 12px;
            display:flex;
            align-items:center;
            gap:8px;
            border:1px solid #eef0f2;
        }
        .search-input{
            width:100%;
            background:transparent;
            border:0;
            outline:none;
            font-size:13px;
            padding: 5px 0;
            color: var(--main-color);
        }
        .search-input::placeholder{
            color:#999;
        }
        /* Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .categories-wrapper{
            padding: 5px 15px 10px 15px;
            overflow-x:auto;
            white-space:nowrap;
            border-top:1px solid #f5f5f5;
            background:transparent;
            -ms-overflow-style:none;
            scrollbar-width:none;
            z-index:90;
        }
        .categories-wrapper::-webkit-scrollbar{
            display:none;
        }
        .filter-btn{
            display:inline-block;
            padding: 6px 14px;
            margin-left:8px;
            background:#fff;
            border: 1px solid var(--secondary-color);
            color: var(--secondary-color);
            border-radius:20px;
            font-weight:600;
            font-size: 12px;
            cursor:pointer;
        }
        .filter-btn.active{
            background:var(--secondary-color);
            color:#fff;
            font-weight:800;
            box-shadow: 0 3px 8px rgba(255, 140, 0, 0.25);
        }

        /* ============ Main ============ */
        main{
            padding:12px;
            min-height:60vh;
            max-width:1100px;
            margin:0 auto;
        }
        
        /* ğŸ”¥ğŸ”¥ Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠ Ø§Ù„Ù…Ø¶Ø§Ù ğŸ”¥ğŸ”¥ */
        .hero-banner {
            background: linear-gradient(135deg, var(--main-color) 0%, #003366 100%);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
            height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 31, 63, 0.15);
        }
        .hero-banner h2 { margin: 0; font-size: 20px; z-index: 2; font-weight: 800; }
        .hero-banner p { margin: 5px 0 0; font-size: 12px; opacity: 0.9; z-index: 2; }
        .hero-banner::after {
             content: ''; position: absolute; right: -25px; bottom: -45px;
             width: 100px; height: 100px; background: var(--secondary-color);
             border-radius: 50%; opacity: 0.3;
        }

        .view-section{
            display:none;
            animation:fadeIn .18s ease forwards;
        }
        .view-section.active{
            display:block;
        }
        .products-grid{
            display:grid;
            grid-template-columns: repeat(2, 1fr);
            gap:10px;
        }

        /* ğŸ”¥ğŸ”¥ ØªÙ†Ø³ÙŠÙ‚ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù‡ÙŠÙƒÙ„ (Skeleton) ğŸ”¥ğŸ”¥ */
        .skeleton {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            position: relative;
            box-shadow: 0 1px 4px rgba(0,0,0,0.03);
            height: 320px; 
            border: 1px solid #f0f0f0;
        }
        .skeleton-shimmer {
            position: absolute; inset:0;
            background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        .skeleton-image { width: 100%; padding-top: 100%; background-color: #f0f0f0; }
        .skeleton-body { padding: 12px 10px; }
        .skeleton-line { height: 14px; background-color: #f0f0f0; margin-bottom: 8px; border-radius: 4px; }


        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†ØªØ¬ (ØªØ¹Ø¯ÙŠÙ„ Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù„ÙˆØ§Ù†) */
        .card{
            background:var(--card-bg);
            border-radius:var(--radius);
            overflow:hidden;
            position:relative;
            box-shadow:0 1px 4px rgba(0,0,0,0.05);
            border: 1px solid #f0f0f0;
        }
        /* ğŸ”¥ğŸ”¥ Ù‡Ø°Ø§ Ù‡Ùˆ ØºÙ„Ø§Ù Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø«Ø§Ø¨ØªØ© Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ù€ card-slider ğŸ”¥ğŸ”¥ */
        .card-image-wrapper{
            position:relative;
            width:100%;
            padding-top:100%;
            background:#fff;
            overflow:hidden;
            cursor:pointer;
        }
        .card-image-wrapper img{
            position:absolute;
            inset:0;
            width:100%;
            height:100%;
            object-fit:cover;
        }
        
        .add-fab{
            position:absolute;
            bottom:10px; /* ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¶Ø¹ */
            left:10px;
            width:34px;
            height:34px;
            background:var(--secondary-color); /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
            border-radius:50%;
            display:flex; align-items:center; justify-content:center;
            font-size:18px; color:#fff;
            box-shadow:0 4px 12px rgba(255, 140, 0, 0.3);
            border:none; /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø¯ÙˆØ¯ */
            cursor:pointer;
            z-index:5;
        }
        .card-body{
            padding:12px 10px;
            cursor:pointer;
        }
        /* ØªØ¹Ø¯ÙŠÙ„ Ù„ÙˆÙ† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„Ù„ÙƒØ­Ù„ÙŠ */
        .name{
            font-size:13px;
            font-weight:600; 
            color: var(--main-color);
            margin-bottom:6px; height:34px; overflow:hidden;
            line-height:1.3; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;
        }
        .price-area{
            display:flex; align-items:baseline; gap:6px; flex-wrap:wrap;
        }
        /* ØªØ¹Ø¯ÙŠÙ„ Ù„ÙˆÙ† Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„Ø¹Ù…Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
        .price{
            font-size:17px;
            font-weight:800;
            color: var(--secondary-color);
        }
        .currency{
            font-size:11px;
            font-weight:700;
            color: var(--secondary-color);
        }
        .old-price{
            font-size:11px;
            text-decoration:line-through;
            color:#999;
            margin-right:6px;
        }
        .discount-tag{
            background:#fff0e6;
            color:var(--secondary-color);
            font-size:9px;
            padding:2px 6px;
            border-radius:3px;
            font-weight:700;
        }
        .extra-info{
            font-size:10px;
            color:#777;
            margin-top:6px;
        }
        /* ØªÙ†Ø³ÙŠÙ‚ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© ÙˆØ§Ù„Ø¥Ø¶Ø§ÙØ© */
        .action-btns-wrapper button { 
            padding: 6px 6px !important;
            font-size: 11px !important;
            font-weight: 600 !important;
            border-radius: 8px;
        }
        .action-btns-wrapper {
            margin-top:8px; display:flex; gap:8px;
        }
        /* Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ */
        .cart-item{
            display:flex; align-items:center; gap:10px; background:#fff;
            padding:10px; border-radius:8px; margin-bottom:10px; border: 1px solid #f0f0f0;
        }
        .qty-btn{
            padding:6px 10px; border-radius:6px; background:#f5f5f5; cursor:pointer; border:0;
            color: var(--main-color);
        }
        .shipping-box, .cart-summary{
            background:#f9f9f9; /* ÙØ§ØªØ­ Ø¬Ø¯Ø§Ù‹ */
            padding:12px; border-radius:8px; margin:10px 0;
        }
        .summary-row{ display:flex; justify-content:space-between; margin-bottom:8px; color:#555; }
        .total-row{ border-top:1px solid #eee; padding-top:10px; display:flex; justify-content:space-between; font-weight:800; }
        .final-price{ color:var(--main-color); font-size:20px; } /* Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙƒØ­Ù„ÙŠ */
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³ÙÙ„ÙŠØ© */
        .checkout-btn{ width:100%; padding:12px; border-radius:99px; font-weight:800; font-size:16px; border:0; cursor:pointer; }
        #checkoutBtnWhatsapp{ background: linear-gradient(90deg,#25D366,#128C7E); color:#fff; } /* Ø£Ø®Ø¶Ø± ÙˆØ§ØªØ³Ø§Ø¨ */
        #checkoutBtnPage{ background: var(--main-color); color:#fff; } /* ÙƒØ­Ù„ÙŠ */
        
        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ */
        .bottom-nav{
            position:fixed; bottom:0; left:0; right:0; background:#fff;
            display:flex; flex-wrap: nowrap; justify-content:space-around; align-items:center;
            border-top:1px solid #eee; z-index:100; padding: 0 0 0 0;
            transition: height 0.3s ease, padding 0.3s ease;
        }
        .nav-home-mode { height: 55px; }
        .nav-cart-mode { height: 120px; align-items: flex-start; padding-top: 10px; }
        .nav-item{ 
            display:flex; flex-direction:column; align-items:center; gap:3px; color:#ccc; 
            font-size:10px; font-weight:500; width:50%; padding:6px 0; cursor:pointer;
        }
        .nav-item.active{ color:var(--secondary-color); font-weight:700; }
        .nav-badge{ position:absolute; top:6px; margin-right:-12px; background:var(--main-color); color:#fff; font-size:9px; padding:2px 6px; border-radius:10px; border:1px solid #fff; }
        .cart-actions-bar { display: flex; gap: 8px; padding: 10px 14px; width: 100%; }

        /* Quick View */
        #quickView{ 
            position: fixed;
            inset: 0;
            background: rgba(0, 31, 63, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            backdrop-filter: blur(5px);
        }
        /* ØªØ¹Ø¯ÙŠÙ„ Ø£Ø¨Ø¹Ø§Ø¯ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© Ø¥Ù„Ù‰ 1x1 */
        .quick-view-img-wrapper{ 
            width:100%; 
            padding-top:100%; 
            position:relative; 
            overflow:hidden; 
            background: #fff;
            border-radius: var(--radius) var(--radius) 0 0;
        }
        .quick-view-img-wrapper img{ 
            position:absolute; 
            inset:0; 
            width:100%; 
            height:100%; 
            object-fit:cover; 
        }
        
        /* Scroll to top button */
        #scrollTopBtn{ 
            position:fixed; 
            bottom:70px; 
            right:15px; 
            width:40px; 
            height:40px; 
            background:var(--main-color); 
            color:#fff; 
            border-radius:50%; 
            display:none; 
            justify-content:center; 
            align-items:center; 
            cursor:pointer; 
            z-index:99; 
            box-shadow:0 3px 10px rgba(0,31,63,0.3);
            font-size:18px;
            font-weight:bold;
        }

        /* ğŸ”¥ğŸ”¥ Dark mode CSS ğŸ”¥ğŸ”¥ */
        .dark body{ background:#001226; color:#e6e6e6; }
        .dark header{ background: rgba(0, 31, 63, 0.98); }
        .dark #darkToggle, .dark #currencyToggle { background: #00254d; color: #fff; border-color: #1a3a5c; }
        .dark .name{ color: #fff; }
        .dark .price, .dark .currency{ color: var(--secondary-color); }
        .dark .card, .dark .cart-item{ background:#001a35; box-shadow:0 2px 8px rgba(0,0,0,0.6); border-color: #1a3a5c; }
        .dark .search-input-wrapper{ background:#00254d; border:1px solid #1a3a5c; }
        .dark .search-input { color: #fff; }
        .dark .categories-wrapper{ border-top-color:#1a3a5c; }
        .dark .bottom-nav{ background:#001a35; border-top-color:#1a3a5c; }
        .dark .shipping-box, .dark .cart-summary{ background:#00254d; border:1px solid #1a3a5c; }
        
        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© */
        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Responsive */
        @media(min-width:800px){ .products-grid{ grid-template-columns: repeat(4, 1fr); } }
    </style>
</head>

<body>
    <header>
        <button id="darkToggle" title="ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ¶Ø¹">ğŸŒ™</button>
        <button id="currencyToggle" onclick="toggleCurrency()" title="ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø©">Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ</button>

        <div class="top-bar">
            <img src="logo.png" alt="Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©" class="store-logo" loading="lazy">
        </div>
        
        <div class="search-container">
            <div class="search-input-wrapper" role="search">
                <span style="font-size:16px; color:var(--secondary-color)">ğŸ”</span>
                <input id="searchInput" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ Ø£Ùˆ ØªØµÙ†ÙŠÙ..." oninput="handleSearch(this.value)" />
                <button id="clearSearch" style="border:0;background:transparent;cursor:pointer;font-weight:700;display:none; color:#999">âœ–</button>
            </div>
        </div>
        
        <div class="categories-wrapper" id="categoriesBar" aria-label="Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª">
        </div>
    </header>

    <main>
        <div id="homeView" class="view-section active">
             <div class="hero-banner">
                <h2>Ø¹Ø±ÙˆØ¶ Ø­ØµØ±ÙŠØ©</h2>
                <p>ØªØ³ÙˆÙ‚ Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ© Ø¨Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</p>
            </div>

            <div id="productsGrid" class="products-grid">
                <div class="skeleton"><div class="skeleton-shimmer"></div><div class="skeleton-image"></div><div class="skeleton-body"><div class="skeleton-line skeleton-name"></div><div class="skeleton-line skeleton-price"></div><div class="skeleton-line skeleton-actions"></div></div></div>
                <div class="skeleton"><div class="skeleton-shimmer"></div><div class="skeleton-image"></div><div class="skeleton-body"><div class="skeleton-line skeleton-name"></div><div class="skeleton-line skeleton-price"></div><div class="skeleton-line skeleton-actions"></div></div></div>
                <div class="skeleton"><div class="skeleton-shimmer"></div><div class="skeleton-image"></div><div class="skeleton-body"><div class="skeleton-line skeleton-name"></div><div class="skeleton-line skeleton-price"></div><div class="skeleton-line skeleton-actions"></div></div></div>
                <div class="skeleton"><div class="skeleton-shimmer"></div><div class="skeleton-image"></div><div class="skeleton-body"><div class="skeleton-line skeleton-name"></div><div class="skeleton-line skeleton-price"></div><div class="skeleton-line skeleton-actions"></div></div></div>
                <div class="skeleton"><div class="skeleton-shimmer"></div><div class="skeleton-image"></div><div class="skeleton-body"><div class="skeleton-line skeleton-name"></div><div class="skeleton-line skeleton-price"></div><div class="skeleton-line skeleton-actions"></div></div></div>
                <div class="skeleton"><div class="skeleton-shimmer"></div><div class="skeleton-image"></div><div class="skeleton-body"><div class="skeleton-line skeleton-name"></div><div class="skeleton-line skeleton-price"></div><div class="skeleton-line skeleton-actions"></div></div></div>
            </div>
        </div>

        <div id="cartView" class="view-section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <button onclick="switchTab('home')" style="background:none; border:none; color:var(--main-color); font-size:14px; font-weight:700; cursor:pointer; padding: 0;"> â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø± </button>
                <div style="display:flex; align-items:center; gap: 15px;">
                    <h3 style="margin:0; font-size:16px; color:var(--main-color)">Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h3>
                    <button onclick="clearCart()" style="background:none; border:none; color:var(--danger); font-size:13px; font-weight:700; cursor:pointer;"> ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙ„ </button>
                </div>
            </div>
            <div id="cartItems"></div>
            <div id="checkoutSection" style="display:none">
                <div class="shipping-box">
                    <label style="font-weight:bold; font-size:13px; color:var(--main-color)">ğŸ“ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙˆØµÙŠÙ„:</label>
                    <select id="shippingSelect" class="shipping-select" onchange="renderCart()" style="border:none; background:transparent; font-weight:bold; color:var(--secondary-color);">
                        <option value="1000">Ø¯Ø§Ø®Ù„ ØµÙ†Ø¹Ø§Ø¡ (+1,000 Ø±.ÙŠ)</option>
                        <option value="2000">Ù…Ø­Ø§ÙØ¸Ø© Ø£Ø®Ø±Ù‰ (+2,000 Ø±.ÙŠ)</option>
                    </select>
                </div>
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</span><span id="productsTotalDisplay">0</span>
                    </div>
                    
                    <div class="summary-row" id="discountRow" style="display:none; color:var(--danger); font-weight:700;">
                        <span>ğŸ’° Ø®ØµÙ… Ø®Ø§Øµ (<span id="discountPercent">0%</span>):</span>
                        <span id="discountDisplay">-0</span>
                    </div>
                    
                    <div class="summary-row">
                        <span>Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„:</span><span id="shippingDisplay">0</span>
                    </div>
                    <div class="total-row">
                        <span style="color:var(--main-color)">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ:</span><span class="final-price" id="finalTotalDisplay">0</span>
                    </div>
                </div>
            </div>
            <div class="empty-state" id="emptyCartMsg" style="display:none; text-align:center; padding:40px; color:#999;">
                <div style="font-size:50px;margin-bottom:10px; opacity:0.3">ğŸ›’</div>
                Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³ÙˆÙ‚!
            </div>
        </div>
    </main>

    <div id="quickView" onclick="if(event.target.id==='quickView')closeQuickView()">
        <div id="quickViewBox"></div>
    </div>

    <div id="scrollTopBtn" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰">â†‘</div>

    <div class="bottom-nav nav-home-mode">
        <div id="homeNavBarContent" style="display:flex; width:100%;">
            <div class="nav-item active" onclick="switchTab('home')">
                <svg viewBox="0 0 24 24" width="22" height="22"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" fill="currentColor"/></svg>
                <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </div>
            <div class="nav-item" onclick="switchTab('cart')" style="position:relative">
                <div class="nav-badge" id="cartBadge" style="display:none">0</div>
                <svg viewBox="0 0 24 24" width="22" height="22"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z" fill="currentColor"/></svg>
                <span>Ø§Ù„Ø³Ù„Ø©</span>
            </div>
        </div>
        <div id="cartActionBarContent" class="cart-actions-bar" style="display:none;">
            <button id="checkoutBtnWhatsapp" class="checkout-btn" onclick="sendCart()" style="flex:1;">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨</button>
            <button id="checkoutBtnPage" class="checkout-btn" onclick="prepareAndRedirectToCheckout()" style="flex:1;">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Ù‹</button>
        </div>
    </div>

    <script type="module">
        // ÙƒÙˆØ¯ Firebase Ø§Ù„Ø£ØµÙ„ÙŠ (Ø¨Ø¯ÙˆÙ† ØªØ¹Ø¯ÙŠÙ„)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB5mEBB0plplzw_d-gAth-TK0xR523IX6nGg", 
            authDomain: "my-fils-575be.firebaseapp.com",
            projectId: "my-fils-575be",
            storageBucket: "my-fils-575be.firebasestorage.app",
            messagingSenderId: "670428095338",
            appId: "1:670428095338:web:75d4a577cc648c208d7b13"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const productsCol = collection(db, "products");
        const categoriesCol = collection(db, "categories");

        // ğŸ”¥ğŸ”¥ ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© (Ø§Ù„Ø®ØµÙ…) - ÙƒÙˆØ¯ Ø£ØµÙ„ÙŠ ğŸ”¥ğŸ”¥
        window.globalSettings = { discountPercentage: 0, minAmountForDiscount: 0 };
        
        async function fetchGlobalSettings() {
            try {
                const docRef = doc(db, "settings", "global"); 
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    window.globalSettings.discountPercentage = data.discountPercentage || 0;
                    window.globalSettings.minAmountForDiscount = data.minAmountForDiscount || 0;
                }
            } catch (e) {
                console.error("Error loading global settings:", e);
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ù…Ù† Firebase
        async function fetchCategories() {
            const categoriesBar = document.getElementById('categoriesBar');
            categoriesBar.innerHTML = '';
            // Ø¥Ø¶Ø§ÙØ© Ø²Ø± "Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ù„Ùƒ" Ø§Ù„Ø«Ø§Ø¨Øª Ø£ÙˆÙ„Ø§Ù‹
            const allBtn = document.createElement('button');
            allBtn.className = 'filter-btn active';
            allBtn.textContent = 'Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ù„Ùƒ';
            allBtn.onclick = () => window.filterProducts('all', allBtn);
            categoriesBar.appendChild(allBtn);

            try {
                const snapshot = await getDocs(categoriesCol);
                const docs = snapshot.docs.map(doc => doc.data());
                // ÙØ±Ø² Ø£Ø¨Ø¬Ø¯ÙŠ Ù„Ù„ØªØµÙ†ÙŠÙØ§Øª
                docs.sort((a, b) => (a.name || '').localeCompare(b.name || ''));
                docs.forEach(data => {
                    const catName = data.name;
                    if (catName) {
                        const btn = document.createElement('button');
                        btn.className = 'filter-btn';
                        btn.textContent = catName;
                        btn.onclick = (e) => window.filterProducts(catName, e.target);
                        categoriesBar.appendChild(btn);
                    }
                });
            } catch (e) {
                console.error("Error loading categories:", e);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† ÙØ§ÙŠØ±Ø¨ÙŠØ³ (ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ fetchGlobalSettings Ù‡Ù†Ø§)
        async function fetchProducts(){
            await fetchCategories();
            await fetchGlobalSettings(); // ğŸ”¥ğŸ”¥ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø¨Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ğŸ”¥ğŸ”¥
            const grid = document.getElementById("productsGrid");
            
            try{
                const snapshot = await getDocs(productsCol);
                const products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                window.allProducts = products || [];
                
                // Ø¥ÙØ±Ø§Øº Ø§Ù„Ø´Ø¨ÙƒØ© Ù…Ù† Ø§Ù„Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø«Ø§Ø¨ØªØ© ÙˆÙ…Ù„Ø¦Ù‡Ø§ Ø¨Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                if(window.renderProducts) window.renderProducts(); 
                
            }catch(err){
                console.error(err);
                // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù‡ÙŠØ§ÙƒÙ„ Ø¨Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„
                grid.innerHTML = `<div style='text-align:center; padding:20px; grid-column:span 2; color:#999'>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙØ§ÙŠØ±Ø¨ÙŠØ³.</div>`;
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Intersection Observers (Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ³ÙˆÙ„ ÙÙ‚Ø·)
        function initObservers(){
            const imgObserver = new IntersectionObserver((entries)=>{
                entries.forEach(entry=>{
                    if(entry.isIntersecting){
                        const img = entry.target;
                        const src = img.dataset.src;
                        if (src) img.src = src;
                        imgObserver.unobserve(img);
                    }
                });
            }, { rootMargin: '0px 0px 100px 0px' });

            document.querySelectorAll('img[data-src]').forEach(img => imgObserver.observe(img));
        }

        // Ø±Ø¨Ø· initObservers Ø¨Ù†Ø§ÙØ°Ø© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡Ø§ Ù…Ù† Ø£ÙŠ Ø³ÙƒØ±Ø¨Øª
        window.initObservers = initObservers; 

        // Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        fetchProducts();
    </script>

    <script>
        /* ====================== Global state ====================== */
        const WHATSAPP = "967773266534";
        const SAR_RATE = 140; // Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù: 1 Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ = 140 Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ
        window.allProducts = window.allProducts || [];
        // window.globalSettings Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø°ÙŠ ÙÙŠ <script type="module">
        let cart = JSON.parse(localStorage.getItem("cart")||"[]") || [];
        let currentFilter = "all";
        let currentCurrency = localStorage.getItem('currentCurrency') || 'YER'; 

        const grid = document.getElementById("productsGrid");
        const cartItemsContainer = document.getElementById("cartItems");
        const cartBadge = document.getElementById("cartBadge");
        const emptyCartMsg = document.getElementById("emptyCartMsg");
        const checkoutSection = document.getElementById("checkoutSection");
        const bottomNav = document.querySelector('.bottom-nav');
        const homeNavBarContent = document.getElementById('homeNavBarContent');
        const cartActionBarContent = document.getElementById('cartActionBarContent');
        const currencyToggleBtn = document.getElementById('currencyToggle');
        
        // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø®ØµÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ)
        const productsTotalDisplay = document.getElementById("productsTotalDisplay");
        const discountRow = document.getElementById("discountRow");
        const discountPercent = document.getElementById("discountPercent");
        const discountDisplay = document.getElementById("discountDisplay");
        
        const shippingDisplay = document.getElementById("shippingDisplay");
        const finalTotalDisplay = document.getElementById("finalTotalDisplay");
        const shippingSelect = document.getElementById("shippingSelect");
        const scrollBtn = document.getElementById("scrollTopBtn");
        const quickViewEl = document.getElementById("quickView");
        const quickViewBox = document.getElementById("quickViewBox");
        const searchInput = document.getElementById("searchInput");
        const clearSearch = document.getElementById("clearSearch");
        const darkToggle = document.getElementById("darkToggle");
        const mainHeader = document.querySelector('header');
        let lastScrollTop = 0;
        /* ğŸ”¥ ØªØ¹Ø¯ÙŠÙ„ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø«Ø§Ø¨Øª ğŸ”¥ */
        const headerHeight = 145; 


        /* ====================== Utils ====================== */
        function saveCart(){ localStorage.setItem("cart", JSON.stringify(cart)); }
        function getHashNumber(str){ 
            let hash=0;
            for(let i=0;i<str.length;i++){
                hash = str.charCodeAt(i) + ((hash<<5)-hash);
            }
            return Math.abs(hash);
        }

        /* ====================== Currency Toggle Logic ====================== */
        function updateCurrencyDisplay() {
            if (currentCurrency === 'SAR') {
                currencyToggleBtn.textContent = 'Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ';
            } else {
                currencyToggleBtn.textContent = 'Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ';
            }
        }
        window.toggleCurrency = function() {
            currentCurrency = (currentCurrency === 'YER' ? 'SAR' : 'YER');
            localStorage.setItem('currentCurrency', currentCurrency);
            updateCurrencyDisplay();
            if (document.getElementById('homeView').classList.contains('active')) {
                renderProducts();
            } else if (document.getElementById('cartView').classList.contains('active')) {
                renderCart();
            }
            if (quickViewEl.style.display === 'flex' && quickViewBox.dataset.productId) {
                quickViewById(quickViewBox.dataset.productId);
            }
        }
        updateCurrencyDisplay();

        /* ====================== Scroll hide header (Ù…ÙØ¹Ø¯Ù‘ÙÙ„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯) ====================== */
        window.addEventListener('scroll', function(){
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            if(scrollTop <= headerHeight / 2){
                mainHeader.classList.remove('header-hidden');
                lastScrollTop = scrollTop;
                scrollBtn.style.display = scrollTop > 400 ? "flex" : "none";
                return;
            }
            if(scrollTop > lastScrollTop) mainHeader.classList.add('header-hidden');
            else mainHeader.classList.remove('header-hidden');
            lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
            scrollBtn.style.display = scrollTop > 400 ? "flex" : "none";
        }, { passive:true });
        scrollBtn.onclick = () => window.scrollTo({ top:0, behavior:'smooth' });

        /* ====================== Dark mode (Ù…ÙØ¹Ø¯Ù‘ÙÙ„) ====================== */
        darkToggle.onclick = () => {
            document.documentElement.classList.toggle('dark');
            const on = document.documentElement.classList.contains('dark');
            localStorage.setItem('dark', on ? '1' : '0');
            darkToggle.textContent = on ? 'â˜€ï¸' : 'ğŸŒ™';
        };
        if(localStorage.getItem('dark') === '1'){
            document.documentElement.classList.add('dark');
            darkToggle.textContent = 'â˜€ï¸';
        }

        /* ====================== Tabs (Ù…ÙØ¹Ø¯Ù‘ÙÙ„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯) ====================== */
        function switchTab(tab){
            document.querySelectorAll('.view-section').forEach(el=>el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el=>el.classList.remove('active'));
            const headerEl = document.querySelector('header');

            if(tab === 'home'){
                document.getElementById('homeView').classList.add('active');
                document.querySelector('.nav-item:first-child').classList.add('active');
                renderProducts();
                cart = JSON.parse(localStorage.getItem("cart")||"[]") || [];
                updateCartBadge();
                
                // ÙˆØ¶Ø¹ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ Ù„ÙˆØ¶Ø¹ Ø§Ù„ØªÙ†Ù‚Ù„
                bottomNav.classList.remove('nav-cart-mode');
                bottomNav.classList.add('nav-home-mode');
                homeNavBarContent.style.display = 'flex';
                cartActionBarContent.style.display = 'none';
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù€ padding-bottom Ùˆ padding-top Ù„Ù„Ø¬Ø³Ù… 
                if (headerEl) headerEl.style.display = 'block';
                document.body.style.paddingTop = 'var(--total-header-height)';
                /* ğŸ”¥ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù€ padding-bottom Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ø¨Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠ Ø§Ù„Ù…Ø¶ØºÙˆØ· ğŸ”¥ */
                document.body.style.paddingBottom = '100px'; 
            } else {
                document.getElementById('cartView').classList.add('active');
                document.querySelector('.nav-item:last-child').classList.add('active');
                cart = JSON.parse(localStorage.getItem("cart")||"[]") || [];
                renderCart();
                // ÙˆØ¶Ø¹ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ Ù„ÙˆØ¶Ø¹ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ù„Ø©
                bottomNav.classList.remove('nav-home-mode');
                bottomNav.classList.add('nav-cart-mode');
                homeNavBarContent.style.display = 'none';
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØªØ¹ÙŠÙŠÙ† padding-bottom ØµØºÙŠØ± Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø³Ù„Ø©
                if (headerEl) headerEl.style.display = 'none';
                document.body.style.paddingTop = '0px';
                document.body.style.paddingBottom = '140px'; 
            }
            window.scrollTo({top:0, behavior:'smooth'});
        }

        /* ====================== Search (Ù…Ø­Ø³Ù‘Ù†) ====================== */
        function normalizeStr(s){
            if(!s) return "";
            return s.toString().toLowerCase().trim();
        }
        function handleSearch(q){
            clearSearch.style.display = q ? "inline-block" : "none";
            if(!window.allProducts || !window.allProducts.length){
                return; 
            }
            if(!q){
                renderProducts();
                return;
            }
            const nq = normalizeStr(q);
            const items = window.allProducts.filter(p => {
                const name = normalizeStr(p.name || p.title || "");
                const cat = normalizeStr(p.category || "");
                const code = normalizeStr(p.id || "");
                return name.includes(nq) || cat.includes(nq) || code.includes(nq);
            });
            drawItems(items);
            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„Ø¨Ø­Ø«
            if (window.initObservers) {
                setTimeout(window.initObservers, 50); 
            }
        }
        clearSearch.onclick = () => {
            searchInput.value='';
            handleSearch('');
        };

        /* ====================== Render & Draw ====================== */
        window.renderProducts = function(){
            let items = currentFilter === 'all' 
                ? (window.allProducts || []) 
                : (window.allProducts || []).filter(p => normalizeStr(p.category) === normalizeStr(currentFilter));
            
            drawItems(items);
            
            // ğŸ”¥ğŸ”¥ Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ø®ØªÙØ§Ø¡ Ø§Ù„ØµÙˆØ±: Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ³ÙˆÙ„ ğŸ”¥ğŸ”¥
            if (window.initObservers) {
                setTimeout(window.initObservers, 50); 
            }
        };
        window.filterProducts = function(cat, btn){
            document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
            currentFilter = cat;
            searchInput.value = "";
            renderProducts();
        }

        function drawItems(items){
            grid.innerHTML = ""; // Ø¥ÙØ±Ø§Øº Ø§Ù„Ø´Ø¨ÙƒØ© Ù„Ø¥Ø²Ø§Ù„Ø© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù‡ÙŠÙƒÙ„

            if(items.length === 0){
                grid.innerHTML = `<div class="empty-state">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© ğŸ”</div>`;
                return;
            }

            items.forEach((p, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                const imgs = Array.isArray(p.image) ? p.image : [p.image || 'placeholder.png'];
                
                // Ø³Ø¹Ø± Ø®Ø§Ù…
                let rawPrice = (p.price || "").toString().replace(/[^0-9.]/g, '');
                let priceVal = parseFloat(rawPrice) || 0;
                let fakeOldPrice = Math.floor(priceVal * 1.3);

                // Ù…Ù†Ø·Ù‚ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø©
                let displayPrice = priceVal;
                let displayOld = fakeOldPrice;
                let displayCurrency = 'Ø±.ÙŠ';
                if (currentCurrency === 'SAR') {
                    displayPrice = Math.ceil(priceVal / SAR_RATE);
                    displayOld = Math.ceil(fakeOldPrice / SAR_RATE);
                    displayCurrency = 'Ø±.Ø³';
                }

                // ğŸ”¥ğŸ”¥ Ø§Ø³ØªØ®Ø¯Ø§Ù… ØºÙ„Ø§Ù Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø«Ø§Ø¨ØªØ© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± ğŸ”¥ğŸ”¥
                const primaryImgSrc = imgs[0] || 'placeholder.png';
                const imgTag = index < 4 
                    ? `<img src="${primaryImgSrc}" alt="${p.name||''}" loading="eager">`
                    : `<img data-src="${primaryImgSrc}" alt="${p.name||''}" loading="lazy">`;

                const hash = getHashNumber(p.id || Math.random().toString(36).slice(2));
                const soldCount = (hash % 901) + 100; 

                const imageWrapper = `
                    <div class="card-image-wrapper" data-id="${p.id}" onclick="openProduct('${p.id}')">
                        ${imgTag}
                        <div class="add-fab" title="Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©" onclick="event.stopPropagation(); addToCart('${p.id}'); showAddedToCartMessage('${p.name}')">+</div>
                    </div>
                `;
                
                const actionBtns = `
                    <div class="action-btns-wrapper">
                        <button style="flex:1; border-radius:8px; border:1px solid var(--main-color); background:#fff; color:var(--main-color); cursor:pointer; padding:8px;" 
                                onclick="event.stopPropagation(); window.quickViewById('${p.id}')">
                            ğŸ‘ï¸ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø³Ø±ÙŠØ¹Ø©
                        </button>
                        <button style="flex:1; border-radius:8px; border:0; background:var(--main-color); color:#fff; cursor:pointer; padding:8px;" 
                                onclick="event.stopPropagation(); addToCart('${p.id}'); showAddedToCartMessage('${p.name}')">
                            Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©
                        </button>
                    </div>
                `;
                
                card.innerHTML = `
                    ${imageWrapper}
                    <div class="card-body" onclick="openProduct('${p.id}')">
                        <div class="name">${p.name || 'Ù…Ù†ØªØ¬'}</div>
                        <div class="price-area">
                            <span class="currency">${displayCurrency}</span>
                            <span class="price">${displayPrice.toLocaleString()}</span>
                        </div>
                        <div style="display:flex; align-items:center; margin-top:6px;">
                            <span class="old-price">${displayOld.toLocaleString()} ${displayCurrency}</span>
                            <span class="discount-tag">-30%</span>
                        </div>
                        <div class="extra-info">ØªÙ… Ø¨ÙŠØ¹ ${soldCount}+ Ù‚Ø·Ø¹Ø©</div>
                        ${actionBtns}
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        /* ====================== Product interactions ====================== */
        window.openProduct = function(id){
            window.location.href = `product.html?id=${id}`;
        }
        
        window.addToCart = function(id){
            cart = JSON.parse(localStorage.getItem("cart")||"[]") || cart || [];
            let item = cart.find(p => p.id === id);
            if(item) item.qty++;
            else{
                const p = (window.allProducts||[]).find(x => x.id === id) || { id: id, name: "Ù…Ù†ØªØ¬", price: "0" };
                cart.push({ id: p.id, name: p.name, price: p.price, qty: 1 });
            }
            saveCart();
            updateCartBadge();
            navigator.vibrate?.(40);
        }
        
        window.showAddedToCartMessage = function(productName){
            const msg = document.createElement('div');
            msg.innerHTML = `
                <div style="position:fixed; top:20px; left:50%; transform:translateX(-50%); background:var(--secondary-color); color:white; padding:12px 20px; border-radius:8px; font-weight:700; z-index:1000; box-shadow:0 4px 15px rgba(255,140,0,0.3); animation:fadeIn 0.3s ease;">
                    âœ“ ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© "${productName}" Ù„Ù„Ø³Ù„Ø©
                </div>
            `;
            document.body.appendChild(msg);
            setTimeout(() => {
                msg.style.animation = 'fadeIn 0.3s ease reverse';
                setTimeout(() => msg.remove(), 300);
            }, 2000);
        }
        
        window.changeQty = function(id, delta){
            cart = JSON.parse(localStorage.getItem("cart")||"[]") || cart;
            let item = cart.find(i => i.id === id);
            if(!item) return;
            item.qty += delta;
            if(item.qty <= 0) cart = cart.filter(i => i.id !== id);
            saveCart();
            renderCart();
            updateCartBadge();
        }

        // Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        window.clearCart = function(){
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ø³Ù„Ø©ØŸ")) {
                cart = [];
                saveCart();
                renderCart();
                updateCartBadge();
            }
        }

        function updateCartBadge(){
            cart = JSON.parse(localStorage.getItem("cart")||"[]") || cart;
            let total = cart.reduce((acc,it)=> acc + (it.qty||0), 0);
            cartBadge.style.display = total > 0 ? "block" : "none";
            cartBadge.textContent = total > 99 ? '99+' : total;
        }

        // ğŸ”¥ğŸ”¥ Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø© (Ù…Ø¹ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø®ØµÙ… Ø§Ù„Ø£ØµÙ„ÙŠ) ğŸ”¥ğŸ”¥
        window.renderCart = function(){
            cart = JSON.parse(localStorage.getItem("cart")||"[]") || cart;
            cartItemsContainer.innerHTML = "";
            
            if(cart.length === 0){
                emptyCartMsg.style.display = "block";
                cartActionBarContent.style.display = "none";
                checkoutSection.style.display = "none";
                return;
            }

            emptyCartMsg.style.display = "none";
            cartActionBarContent.style.display = "flex";
            checkoutSection.style.display = "block";
            
            let productSubTotal = 0; // Ù…Ø¬Ù…ÙˆØ¹ Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø®Ø§Ù… (Ø¨Ø§Ù„ÙŠÙ…Ù†ÙŠ)
            cart.forEach(item => {
                let rawPrice = (item.price || "").toString().replace(/[^0-9.]/g,'');
                let priceVal = parseFloat(rawPrice) || 0;
                productSubTotal += priceVal * (item.qty || 0);

                let itemDisplayPrice = priceVal.toLocaleString() + " Ø±.ÙŠ";
                cartItemsContainer.innerHTML += `
                    <div class="cart-item">
                        <div style="flex:1">
                            <div style="font-weight:700; color:var(--main-color)">${item.name}</div>
                            <div style="color:#888">${itemDisplayPrice}</div>
                        </div>
                        <div style="display:flex; align-items:center; gap:8px;">
                            <button class="qty-btn" onclick="changeQty('${item.id}',1)">+</button>
                            <div style="font-weight:700">${item.qty}</div>
                            <button class="qty-btn" onclick="changeQty('${item.id}',-1)">-</button>
                        </div>
                    </div>
                `;
            });

            // ğŸ”¥ğŸ”¥ 1. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø®ØµÙ… - ÙƒÙˆØ¯ Ø£ØµÙ„ÙŠ ğŸ”¥ğŸ”¥
            const settings = window.globalSettings || { discountPercentage: 0, minAmountForDiscount: 0 };
            const { discountPercentage, minAmountForDiscount } = settings;
            let discountAmount = 0;
            
            if (productSubTotal >= minAmountForDiscount && discountPercentage > 0) {
                discountAmount = (productSubTotal * discountPercentage) / 100;
                discountRow.style.display = 'flex';
                discountPercent.innerText = discountPercentage + '%';
            } else {
                discountRow.style.display = 'none';
            }

            let finalProductTotalYER = productSubTotal - discountAmount;
            let shippingCostYER = parseInt(shippingSelect.value || "1000");
            let finalTotalYER = finalProductTotalYER + shippingCostYER;


            // ğŸ”¥ğŸ”¥ 2. ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ - ÙƒÙˆØ¯ Ø£ØµÙ„ÙŠ ğŸ”¥ğŸ”¥
            let displayCurrencySymbol = ' Ø±.ÙŠ';
            let productsTotalDisplayValue = productSubTotal;
            let discountDisplayValue = discountAmount;
            let shippingDisplayValue = shippingCostYER;
            let finalTotalDisplayValue = finalTotalYER;


            if (currentCurrency === 'SAR') {
                displayCurrencySymbol = ' Ø±.Ø³';
                // Ø§Ù„ØªØ­ÙˆÙŠÙ„ ÙŠØªÙ… Ø¨Ø¹Ø¯ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…
                productsTotalDisplayValue = Math.ceil(productSubTotal / SAR_RATE);
                discountDisplayValue = Math.ceil(discountAmount / SAR_RATE);
                shippingDisplayValue = Math.ceil(shippingCostYER / SAR_RATE);
                finalTotalDisplayValue = Math.ceil(finalTotalYER / SAR_RATE);
            }
            
            // 3. Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            productsTotalDisplay.innerText = productsTotalDisplayValue.toLocaleString() + displayCurrencySymbol;
            discountDisplay.innerText = (discountAmount > 0 ? '-' : '') + discountDisplayValue.toLocaleString() + displayCurrencySymbol;
            shippingDisplay.innerText = shippingDisplayValue.toLocaleString() + displayCurrencySymbol;
            finalTotalDisplay.innerText = finalTotalDisplayValue.toLocaleString() + displayCurrencySymbol;
        }

        /* ====================== Send cart via WhatsApp ====================== */
        window.sendCart = function(){
            cart = JSON.parse(localStorage.getItem("cart")||"[]") || cart;
            if(cart.length === 0) return;
            
            let msg = "Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ÙŠØ¯ Ø·Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:\n\n";
            let productSubTotal = 0; // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙ…
            
            cart.forEach((i, idx) => {
                let rawPrice = (i.price || "").toString().replace(/[^0-9.]/g, '');
                let priceVal = parseFloat(rawPrice) || 0;
                productSubTotal += priceVal * (i.qty || 0);
                msg += `${idx+1}. ${i.name} (Ø¹Ø¯Ø¯ ${i.qty})\n`;
            });
            
            // ğŸ”¥ğŸ”¥ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø®ØµÙ… - ÙƒÙˆØ¯ Ø£ØµÙ„ÙŠ ğŸ”¥ğŸ”¥
            const settings = window.globalSettings || { discountPercentage: 0, minAmountForDiscount: 0 };
            const { discountPercentage, minAmountForDiscount } = settings;
            let discountAmount = 0;
            if (productSubTotal >= minAmountForDiscount && discountPercentage > 0) {
                discountAmount = (productSubTotal * discountPercentage) / 100;
            }
            let finalProductTotalYER = productSubTotal - discountAmount;
            let shippingCostYER = parseInt(shippingSelect.value || "1000");
            let finalTotalYER = finalProductTotalYER + shippingCostYER;
            
            
            // ğŸ”¥ğŸ”¥ ØªØ·Ø¨ÙŠÙ‚ Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© - ÙƒÙˆØ¯ Ø£ØµÙ„ÙŠ ğŸ”¥ğŸ”¥
            let displayCurrencySymbol = ' Ø±.ÙŠ';
            let displayProductSubTotal = productSubTotal;
            let displayDiscountAmount = discountAmount;
            let displayShippingCost = shippingCostYER;
            let displayFinalTotal = finalTotalYER;

            if (currentCurrency === 'SAR') {
                displayCurrencySymbol = ' Ø±.Ø³';
                displayProductSubTotal = Math.ceil(productSubTotal / SAR_RATE);
                displayDiscountAmount = Math.ceil(discountAmount / SAR_RATE);
                displayShippingCost = Math.ceil(shippingCostYER / SAR_RATE);
                displayFinalTotal = Math.ceil(finalTotalYER / SAR_RATE);
            }
            
            const shippingLocation = shippingSelect.options[shippingSelect.selectedIndex].text;
            
            msg += `\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nğŸ“¦ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${displayProductSubTotal.toLocaleString()}${displayCurrencySymbol}`;
            
            if (discountAmount > 0) {
                msg += `\nğŸ’° Ø§Ù„Ø®ØµÙ… (${discountPercentage}%): -${displayDiscountAmount.toLocaleString()}${displayCurrencySymbol}`;
            }
            
            msg += `\nğŸ“ Ø§Ù„ØªÙˆØµÙŠÙ„: +${displayShippingCost.toLocaleString()}${displayCurrencySymbol}`;
            msg += `\nğŸŒŸ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${displayFinalTotal.toLocaleString()}${displayCurrencySymbol}`;

            window.open(`https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`);
        }
        
        window.prepareAndRedirectToCheckout = function(){
            cart = JSON.parse(localStorage.getItem("cart")||"[]") || cart;
            if(cart.length === 0) return;

            let productTotal = 0;
            cart.forEach(item => {
                let rawPrice = (item.price || "").toString().replace(/[^0-9.]/g, '');
                productTotal += (parseFloat(rawPrice) || 0) * (item.qty || 0);
            });
            
            // ğŸ”¥ğŸ”¥ Ø­ÙØ¸ Ø§Ù„Ø®ØµÙ… ÙˆØ§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© YER) - ÙƒÙˆØ¯ Ø£ØµÙ„ÙŠ ğŸ”¥ğŸ”¥
            const settings = window.globalSettings || { discountPercentage: 0, minAmountForDiscount: 0 };
            const { discountPercentage, minAmountForDiscount } = settings;
            let discountAmount = 0;
            if (productTotal >= minAmountForDiscount && discountPercentage > 0) {
                discountAmount = (productTotal * discountPercentage) / 100;
            }
            
            let finalProductTotal = productTotal - discountAmount;
            let shippingCost = parseInt(shippingSelect.value || "1000");
            let finalTotal = finalProductTotal + shippingCost;
            
            
            localStorage.setItem("checkoutSummary", JSON.stringify({ 
                subTotal: productTotal, 
                discountAmount: discountAmount, // Ø­ÙØ¸ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…
                finalTotal, 
                shipping:{ cost: shippingCost, location: shippingSelect.options[shippingSelect.selectedIndex].text } 
            }));
            window.location.href = 'checkout.html';
        }

        /* ====================== Quick View (Ù…ÙØµÙ„Ù‘ÙØ­) ====================== */
        window.quickViewById = function(id){
            const p = (window.allProducts || []).find(x => x.id === id);
            if(!p) return quickView({ id, name: 'Ù…Ù†ØªØ¬', price: 0, image: 'placeholder.png' });
            quickView(p);
        }

        function quickView(product){
            const imgs = Array.isArray(product.image) ? product.image : [product.image || 'placeholder.png'];
            const primaryImgSrc = imgs[0] || 'placeholder.png';

            let rawPrice = (product.price || "").toString().replace(/[^0-9.]/g, '');
            let priceVal = parseFloat(rawPrice) || 0;
            let displayPrice = priceVal.toLocaleString();
            let displayCurrency = 'Ø±.ÙŠ';

            if (currentCurrency === 'SAR') {
                displayPrice = Math.ceil(priceVal / SAR_RATE).toLocaleString();
                displayCurrency = 'Ø±.Ø³';
            }

            quickViewBox.innerHTML = `
                <div style="position:relative; background:white; border-radius:var(--radius); max-width:95vw; width:320px; max-height:85vh; overflow-y:auto; animation:zoomIn .15s ease forwards; margin:auto;">
                    <button onclick="closeQuickView()" style="position:absolute; top:10px; left:10px; background:rgba(0,0,0,0.3); color:white; border:none; border-radius:50%; width:30px; height:30px; font-size:16px; cursor:pointer; z-index:10;">âœ•</button>
                    <div class="quick-view-img-wrapper">
                        <img src="${primaryImgSrc}" alt="${product.name||''}" loading="eager">
                    </div>
                    <div style="padding:16px;">
                        <h3 style="margin:0 0 10px 0; color:var(--main-color); font-size:16px;">${product.name || ''}</h3>
                        <div style="font-size:22px; color:var(--secondary-color); font-weight:800; margin-bottom:15px;">${displayPrice} ${displayCurrency}</div>
                        <div style="color:#666; font-size:14px; line-height:1.5; margin-bottom:20px;">${product.description || 'Ù…Ù†ØªØ¬ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø© Ù…Ù† Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©'}</div>
                        <div style="margin-top:20px; display:flex; gap:10px; flex-direction:column;">
                            <button style="width:100%; padding:12px; border-radius:8px; border:0; background:var(--secondary-color); color:#fff; font-weight:800; font-size:16px; cursor:pointer;" 
                                    onclick="addToCart('${product.id}'); closeQuickView(); showAddedToCartMessage('${product.name}');">
                                Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©
                            </button>
                            <button style="width:100%; padding:12px; border-radius:8px; border:1px solid var(--main-color); background:#fff; color:var(--main-color); font-weight:700; font-size:16px; cursor:pointer;" 
                                    onclick="openProduct('${product.id}'); closeQuickView();">
                                Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ù†ØªØ¬
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            quickViewBox.dataset.productId = product.id; 
            quickViewEl.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        window.closeQuickView = function(){
            quickViewEl.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        /* ====================== Initial setup ====================== */
        window.onpageshow = function(event){
            if(event.persisted || performance?.navigation?.type == 2){
                cart = JSON.parse(localStorage.getItem("cart")||"[]") || [];
                updateCartBadge();
            }
        };

        updateCartBadge();

    </script>
</body>
</html>
