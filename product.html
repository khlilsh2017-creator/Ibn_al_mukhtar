<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title id="productTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

<style>
    :root {
        --aliexpress-red: #FF4747; 
        --bg-color: #f8f9fa;
        --card-bg: #ffffff;
        --text-color: #222;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
        margin: 0; background: var(--bg-color); color: var(--text-color);
        font-family: 'Tajawal', sans-serif;
        padding-bottom: 120px; 
    }
    
    /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
    header {
        position: fixed; top: 0; left: 0; right: 0;
        height: 50px; background: #fff;
        display: flex; align-items: center; justify-content: space-between;
        padding: 0 15px; z-index: 100;
        box-shadow: 0 1px 5px rgba(0,0,0,0.05);
    }
    .back-btn {
        font-size: 24px; color: #333; text-decoration: none; font-weight: bold;
    }
    .main-content { padding-top: 50px; }

    /* ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬ (Ø³Ù„Ø§ÙŠØ¯Ø±) */
    .product-images { 
        width: 100%; padding-top: 100%; position: relative;
        background: #fff; overflow: hidden;
    }
    .product-images img {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        object-fit: contain; /* Ù„ØªØ¸Ù‡Ø± Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
        opacity: 0; transition: opacity 0.4s;
    }
    .product-images img.active { opacity: 1; }
    .nav-dots {
        position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
        display: flex; gap: 8px; z-index: 10;
    }
    .dot {
        width: 8px; height: 8px; border-radius: 50%; background: #ccc;
        transition: 0.3s;
    }
    .dot.active { background: var(--aliexpress-red); }

    /* ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ */
    .details-card {
        background: var(--card-bg); padding: 15px; margin-bottom: 10px;
        border-bottom: 1px solid #eee;
    }
    .price-area { display: flex; align-items: flex-end; gap: 8px; margin-bottom: 5px; }
    .price { font-size: 28px; font-weight: 800; color: var(--aliexpress-red); }
    .currency { font-size: 14px; font-weight: 700; color: var(--aliexpress-red); }
    .old-price { font-size: 14px; text-decoration: line-through; color: #999; }
    .product-name { font-size: 18px; font-weight: 700; color: var(--text-color); line-height: 1.4; }
    .description-card { padding: 15px; }
    .description-card h3 { font-size: 16px; border-bottom: 2px solid #eee; padding-bottom: 5px; margin-bottom: 10px; }
    .description-text { font-size: 14px; color: #555; line-height: 1.6; white-space: pre-wrap; }

    /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³ÙÙ„ÙŠ */
    .bottom-actions {
        position: fixed; bottom: 0; left: 0; right: 0; height: 70px;
        background: #fff; display: flex; align-items: center; padding: 0 15px;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 100;
    }
    .btn-cart {
        flex: 1; padding: 15px; background: #FFC000; color: #222; 
        border: none; border-radius: 99px 0 0 99px; font-size: 15px; 
        font-weight: bold; cursor: pointer;
    }
    .btn-buy {
        flex: 1; padding: 15px; background: var(--aliexpress-red); color: #fff;
        border: none; border-radius: 0 99px 99px 0; font-size: 15px; 
        font-weight: bold; cursor: pointer;
    }
    .loading-msg { text-align: center; padding: 50px; color: #999; }
</style>
</head>
<body>

<header>
    <a href="index.html" class="back-btn">â†’</a>
    <span style="font-size: 16px; font-weight: 700;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</span>
    <span style="width: 24px;"></span>
</header>

<div class="main-content">
    
    <div id="loading" class="loading-msg">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬...</div>

    <div id="productDetails" style="display:none;">
        
        <div class="product-images" id="imageSlider">
            </div>

        <div class="details-card">
            <div class="price-area">
                <span class="currency">Ø±.ÙŠ</span>
                <span class="price" id="displayPrice">0</span>
                <span class="old-price" id="displayOldPrice">0 Ø±.ÙŠ</span>
            </div>
            <div class="product-name" id="displayName"></div>
        </div>

        <div class="description-card">
            <h3>ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬</h3>
            <div class="description-text" id="displayDescription"></div>
        </div>
        
    </div>
</div>

<div class="bottom-actions">
    <button class="btn-cart" onclick="addToCartAndNotify(window.currentProductId)">ğŸ›’ Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</button>
    <button class="btn-buy" onclick="buyNow(window.currentProductId)">Ø§Ø´ØªØ± Ø§Ù„Ø¢Ù†</button>
</div>


<script type="module">
  // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…Ù† Ø±ÙˆØ§Ø¨Ø· CDN
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getFirestore, doc, getDoc, collection } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

  // Ù…ÙØ§ØªÙŠØ­ Ù…Ø´Ø±ÙˆØ¹Ùƒ
  const firebaseConfig = {
    apiKey: "AIzaSyB5mEBB0plzw_d-gAth-TK0xR523IX6nGg",
    authDomain: "my-fils-575be.firebaseapp.com",
    projectId: "my-fils-575be",
    storageBucket: "my-fils-575be.firebasestorage.app",
    messagingSenderId: "670428095338",
    appId: "1:670428095338:web:75d4a577cc648c208d7b13"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const productsCol = collection(db, "products");

  // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¢ÙŠØ¯ÙŠ Ù…Ù† Ø±Ø§Ø¨Ø· URL
  function getProductIdFromUrl() {
    const params = new URLSearchParams(window.location.search);
    return params.get('id');
  }

  // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬
  async function fetchAndRenderProduct() {
    const productId = getProductIdFromUrl();
    window.currentProductId = productId; // Ø­ÙØ¸ Ø§Ù„Ø¢ÙŠØ¯ÙŠ ÙÙŠ Ù…ØªØºÙŠØ± Ø¹Ø§Ù…
    
    document.getElementById('loading').style.display = 'block';
    document.getElementById('productDetails').style.display = 'none';

    if (!productId) {
      document.getElementById('loading').innerHTML = 'âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†ØªØ¬.';
      return;
    }
    
    try {
      // Ø¬Ù„Ø¨ ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† ÙØ§ÙŠØ±Ø¨ÙŠØ³
      const docRef = doc(db, "products", productId);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        const p = docSnap.data();
        
        // 1. ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© ÙˆØ§Ù„Ø§Ø³Ù…
        document.getElementById('productTitle').textContent = p.name;
        document.getElementById('displayName').textContent = p.name;
        
        // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ÙˆØµÙ
        let rawPrice = p.price.toString().replace(/[^0-9.]/g, '');
        let priceVal = parseFloat(rawPrice) || 0;
        let fakeOldPrice = Math.floor(priceVal * 1.3); // Ø³Ø¹Ø± ÙˆÙ‡Ù…ÙŠ Ø£Ø¹Ù„Ù‰

        document.getElementById('displayPrice').textContent = priceVal.toLocaleString();
        document.getElementById('displayOldPrice').textContent = fakeOldPrice.toLocaleString() + " Ø±.ÙŠ";
        document.getElementById('displayDescription').textContent = p.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬.';
        
        // 3. Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±
        const slider = document.getElementById('imageSlider');
        slider.innerHTML = '';
        const dotsContainer = document.createElement('div');
        dotsContainer.className = 'nav-dots';
        
        const images = Array.isArray(p.image) ? p.image : [p.image];
        
        images.forEach((imgSrc, index) => {
            const img = document.createElement('img');
            img.src = imgSrc;
            if (index === 0) img.classList.add('active');
            slider.appendChild(img);

            const dot = document.createElement('span');
            dot.className = 'dot';
            if (index === 0) dot.classList.add('active');
            dotsContainer.appendChild(dot);
        });
        
        slider.appendChild(dotsContainer);
        startSlider(slider, dotsContainer);
        
        document.getElementById('loading').style.display = 'none';
        document.getElementById('productDetails').style.display = 'block';
        
      } else {
        document.getElementById('loading').innerHTML = 'âŒ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±.';
      }

    } catch (e) {
      console.error("Error fetching document: ", e);
      document.getElementById('loading').innerHTML = 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.';
    }
  }
  
  // ØªØ´ØºÙŠÙ„ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ù„Ø¨ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
  fetchAndRenderProduct();

  // ------------------------------------------------------------------
  // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø³Ù„Ø© (Cart Functions)
  // ------------------------------------------------------------------
  const WHATSAPP = "967773266534";
  
  function getProductDetails(id) {
    // Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© ÙŠÙØªØ±Ø¶ Ø£Ù† ØªØ¬Ù„Ø¨ Ø§Ø³Ù… ÙˆØ³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬ØŒ Ù„ÙƒÙ† Ù„Ø£Ù†Ù†Ø§ Ù„Ø§ Ù†Ø¬Ù„Ø¨ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‡Ù†Ø§
    // Ø³Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ Ø¬Ù„Ø¨Ù†Ø§Ù‡Ø§ Ù…Ù† Firebase ÙÙ‚Ø·
    const name = document.getElementById('displayName').textContent;
    const price = document.getElementById('displayPrice').textContent.replace(/,/g, '') + " Ø±.ÙŠ";
    return { id, name, price };
  }

  window.addToCartAndNotify = function(id) {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    let item = cart.find(p => p.id === id);
    
    if(item) {
      item.qty++;
    } else {
      const p = getProductDetails(id);
      cart.push({id: p.id, name: p.name, price: p.price, qty: 1});
    }
    
    localStorage.setItem("cart", JSON.stringify(cart));
    alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©!");
    navigator.vibrate?.(50);
  }

  window.buyNow = function(id) {
    const p = getProductDetails(id);
    const priceRaw = parseFloat(p.price.replace(/[^0-9.]/g, '')) || 0;
    
    let msg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ÙŠØ¯ Ø·Ù„Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙˆØ±Ø§Ù‹:\n\n`;
    msg += `*${p.name}*\n`;
    msg += `Ø§Ù„Ø³Ø¹Ø±: ${priceRaw.toLocaleString()} Ø±.ÙŠ\n\n`;
    msg += `*Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙˆØµÙŠÙ„.*`;
    
    window.open(`https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`);
  }

  // Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† ØµÙˆØ±Ø©)
  function startSlider(slider, dotsContainer) {
    const imgs = slider.querySelectorAll("img");
    const dots = dotsContainer.querySelectorAll(".dot");
    if(imgs.length <= 1) {
        dotsContainer.style.display = 'none';
        return;
    }
    
    let index = 0;
    setInterval(() => {
        imgs[index].classList.remove("active");
        dots[index].classList.remove("active");
        
        index = (index + 1) % imgs.length;
        
        imgs[index].classList.add("active");
        dots[index].classList.add("active");
    }, 3000);
  }

</script>

</body>
</html>
 
