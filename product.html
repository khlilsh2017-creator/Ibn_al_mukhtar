<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

<style>
  :root {
    --aliexpress-red: #FF4747; 
    --aliexpress-orange: #FF8238;
    --bg-color: #f2f2f2;
    --card-bg: #ffffff;
    --text-color: #222;
  }

  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body {
    margin: 0; background: var(--bg-color); color: var(--text-color);
    font-family: 'Tajawal', sans-serif; padding-bottom: 80px;
  }

  /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¹Ø§Ø¦Ù… */
  .header-actions {
    position: fixed; top: 0; left: 0; right: 0;
    display: flex; justify-content: space-between; align-items: center;
    padding: 10px 15px; z-index: 100;
    pointer-events: none;
  }
  
  .icon-btn {
    width: 40px; height: 40px; background: rgba(0,0,0,0.4);
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    color: #fff; text-decoration: none;
    backdrop-filter: blur(4px); pointer-events: auto;
  }

  /* Ø³Ù„Ø© Ù„Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø· */
  .cart-display-only {
    width: 40px; height: 40px; background: rgba(0,0,0,0.4);
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    color: #fff; backdrop-filter: blur(4px);
    position: relative;
    pointer-events: none; /* ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù†Ù‚Ø± */
  }

  .badge {
    position: absolute; top: -2px; right: -2px;
    background: var(--aliexpress-red); color: #fff;
    font-size: 10px; width: 18px; height: 18px;
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    border: 1px solid #fff;
  }

  /* Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± Ø§Ù„ÙŠØ¯ÙˆÙŠ */
  .hero-slider {
    position: relative; width: 100%; height: 100vw; max-height: 450px;
    background: #fff;
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
  }
  
  .hero-slider::-webkit-scrollbar { display: none; }

  .hero-slider img {
    width: 100%; height: 100%;
    flex-shrink: 0; object-fit: contain;
    scroll-snap-align: center;
  }

  .dots {
    position: absolute; bottom: 15px; left: 0; right: 0;
    display: flex; justify-content: center; gap: 6px; z-index: 5;
    pointer-events: none;
  }
  .dot { width: 8px; height: 8px; border-radius: 50%; background: rgba(0,0,0,0.1); transition: 0.3s; }
  .dot.active { background: var(--aliexpress-red); transform: scale(1.2); }

  /* Ø§Ù„ØªÙØ§ØµÙŠÙ„ */
  .product-info-card {
    background: #fff; padding: 15px; margin-bottom: 10px;
    border-bottom: 1px solid #eee;
  }
  .price-row { display: flex; align-items: baseline; gap: 6px; margin-bottom: 8px; }
  .current-price { font-size: 24px; font-weight: 800; color: var(--aliexpress-red); }
  .currency { font-size: 14px; font-weight: 700; color: var(--aliexpress-red); }
  .old-price-row { display: flex; align-items: center; gap: 8px; color: #999; font-size: 13px; margin-bottom: 10px; }
  .old-price { text-decoration: line-through; }
  .discount-label {
    background: #ffe6e6; color: var(--aliexpress-red);
    padding: 2px 6px; border-radius: 4px; font-weight: 700; font-size: 11px;
  }
  .product-title { font-size: 16px; font-weight: 400; line-height: 1.4; color: #000; margin-bottom: 10px; }
  .extra-stats {
    display: flex; justify-content: space-between; 
    font-size: 12px; color: #777; padding-top: 10px; border-top: 1px solid #f5f5f5;
  }
  .description-box { background: #fff; padding: 15px; margin-top: 10px; }
  .sec-title { font-size: 14px; font-weight: 700; margin-bottom: 8px; }
  .desc-text { font-size: 13px; line-height: 1.6; color: #555; white-space: pre-wrap; }

  /* Ø§Ù„Ø¨Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠ */
  .bottom-actions {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: #fff; padding: 10px 15px;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    display: flex; gap: 10px; z-index: 100;
  }
  .action-btn {
    flex: 1; border: none; padding: 12px; border-radius: 99px;
    font-weight: 700; font-size: 14px; color: #fff; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
  }
  .btn-cart { background: linear-gradient(90deg, #FFB75E, #FF8238); }
  .btn-buy { background: linear-gradient(90deg, #FF512F, #DD2476); }
  .action-btn:active { opacity: 0.9; transform: scale(0.98); }

  /* Toast */
  .toast {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.8); color: #fff; padding: 15px 25px;
    border-radius: 8px; font-size: 14px; z-index: 200; text-align: center;
    opacity: 0; visibility: hidden; transition: 0.3s; pointer-events: none;
  }
  .toast.show { opacity: 1; visibility: visible; }
  .toast-icon { font-size: 30px; display: block; margin-bottom: 5px; }
</style>
</head>
<body>

<div class="header-actions">
  <a href="index.html" class="icon-btn">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
  </a>
  
  <div class="cart-badge-wrapper">
    <div class="cart-display-only">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 20a1 1 0 100-2 1 1 0 000 2zm7 0a1 1 0 100-2 1 1 0 000 2zM1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"/></svg>
    </div>
    <div id="headerCartBadge" class="badge" style="display:none">0</div>
  </div>
</div>

<div id="productContent"></div>

<div id="toast" class="toast">
  <span class="toast-icon">âœ…</span>
  ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©
</div>

<script>
  const WHATSAPP = "967773266534";
  const params = new URLSearchParams(window.location.search);
  const productId = params.get("id");

  const allProducts = JSON.parse(localStorage.getItem("products")) || [];
  const product = allProducts.find(p => p.id == productId);
  const container = document.getElementById("productContent");

  if (!product) {
    container.innerHTML = `<div style="text-align:center;padding:100px 20px;color:#888;">
      Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!<br><br><a href="index.html" style="color:var(--aliexpress-red)">Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ØªØ¬Ø±</a>
    </div>`;
  } else {
    const imgs = Array.isArray(product.image) ? product.image : [product.image];
    
    // Ø¨Ù†Ø§Ø¡ Ø§Ù„ØµÙˆØ±
    let sliderHtml = "";
    let dotsHtml = "";
    imgs.forEach((img, index) => {
      sliderHtml += `<img src="${img}">`;
      if(imgs.length > 1) dotsHtml += `<div class="dot ${index === 0 ? 'active' : ''}"></div>`;
    });

    let rawPrice = product.price.replace(/[^0-9.]/g, '');
    let priceVal = parseFloat(rawPrice) || 0;
    let fakeOldPrice = Math.floor(priceVal * 1.3);
    
    // ğŸ”¥ğŸ”¥ Ù‡Ù†Ø§ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… Ø¨ÙŠÙ† 100 Ùˆ 1000
    // Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù€ ID Ø¹Ø´Ø§Ù† Ø§Ù„Ø±Ù‚Ù… ÙŠÙƒÙˆÙ† Ø«Ø§Ø¨Øª Ù„Ù†ÙØ³ Ø§Ù„Ù…Ù†ØªØ¬ ÙˆÙ…Ø§ ÙŠØªØºÙŠØ± Ù…Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«
    // Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©: (ID * Ø±Ù‚Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ) % (Ø§Ù„Ù†Ø·Ø§Ù‚) + Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰
    // Ø§Ù„Ù†Ø·Ø§Ù‚ Ù‡Ùˆ 900 (Ù…Ù† 0 Ø¥Ù„Ù‰ 899) + 100 = Ù…Ù† 100 Ø¥Ù„Ù‰ 999
    let soldCount = (product.id * 75) % 901 + 100;

    const description = product.description ? product.description : "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ø¥Ø¶Ø§ÙÙŠ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬.";

    container.innerHTML = `
      <div class="hero-slider" id="slider" onscroll="updateDots()">
        ${sliderHtml}
      </div>
      
      ${imgs.length > 1 ? `<div class="dots" id="dotsContainer">${dotsHtml}</div>` : ''}

      <div class="product-info-card">
        <div class="price-row">
          <span class="currency">Ø±.ÙŠ</span>
          <span class="current-price">${priceVal.toLocaleString()}</span>
        </div>
        
        <div class="old-price-row">
          <span class="old-price">${fakeOldPrice.toLocaleString()} Ø±.ÙŠ</span>
          <span class="discount-label">-30%</span>
        </div>

        <h1 class="product-title">${product.name}</h1>

        <div class="extra-stats">
          <span>â­ 4.8 (ØªÙ‚ÙŠÙŠÙ…Ø§Øª)</span>
          <span>ØªÙ… Ø¨ÙŠØ¹ ${soldCount}+</span>
        </div>
      </div>

      <div class="description-box">
        <div class="sec-title">Ø§Ù„ØªÙØ§ØµÙŠÙ„</div>
        <div class="desc-text">${description}</div>
      </div>
      
      <div style="height:20px;"></div>

      <div class="bottom-actions">
        <button onclick="addToCart(${product.id})" class="action-btn btn-cart">
          Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©
        </button>
        <button onclick="orderViaWhatsapp()" class="action-btn btn-buy">
          Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¢Ù†
        </button>
      </div>
    `;
  }

  /* ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø³Ø­Ø¨ */
  function updateDots() {
    const slider = document.getElementById("slider");
    const dots = document.querySelectorAll(".dot");
    if(dots.length === 0) return;

    let index = Math.round(slider.scrollLeft / slider.offsetWidth);
    index = Math.abs(index);

    dots.forEach(d => d.classList.remove("active"));
    if(dots[index]) dots[index].classList.add("active");
  }

  function addToCart(id) {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    let item = cart.find(p => p.id === id);
    if(item) {
      item.qty++;
    } else {
      cart.push({id: product.id, name: product.name, price: product.price, qty: 1});
    }
    localStorage.setItem("cart", JSON.stringify(cart));
    
    updateHeaderBadge();
    showToast();
    navigator.vibrate?.(50);
  }

  function updateHeaderBadge() {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    let total = cart.reduce((acc, item) => acc + item.qty, 0);
    const badge = document.getElementById("headerCartBadge");
    if(total > 0) {
      badge.style.display = "flex";
      badge.textContent = total > 99 ? '99+' : total;
    } else {
      badge.style.display = "none";
    }
  }

  function showToast() {
    const toast = document.getElementById("toast");
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 1500);
  }

  function orderViaWhatsapp() {
    if(!product) return;
    const msg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ÙŠØ¯ Ø´Ø±Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬:\n\n*${product.name}*\nØ§Ù„Ø³Ø¹Ø±: ${product.price}\n\nØ§Ù„Ø±Ø§Ø¨Ø·: ${window.location.href}`;
    window.open(`https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`);
  }

  updateHeaderBadge();
</script>

</body>
</html>

