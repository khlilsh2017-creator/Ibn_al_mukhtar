<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #c6a047;
      --bg-color: #f8f9fa;
      --card-bg: #ffffff;
      --text-color: #333;
      --danger: #ff4d4d;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      font-family: 'Tajawal', sans-serif;
      background: var(--bg-color); color: var(--text-color);
      margin: 0; padding: 0; padding-top: 70px; padding-bottom: 40px;
    }
    header {
      position: fixed; top: 0; left: 0; right: 0;
      height: 60px; background: #fff;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 100;
    }
    header h1 { margin: 0; font-size: 18px; font-weight: 800; color: var(--primary); }
    .home-link {
      text-decoration: none; font-size: 14px; font-weight: bold; color: #333;
      background: #eee; padding: 6px 12px; border-radius: 20px;
    }
    .container { max-width: 600px; margin: 0 auto; padding: 16px; }
    .card {
      background: var(--card-bg); border-radius: 20px;
      padding: 20px; margin-bottom: 24px;
      border: 1px solid #f0f0f0; box-shadow: 0 4px 15px rgba(0,0,0,0.03);
    }
    h2 { margin-top: 0; font-size: 16px; color: var(--primary); border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; margin-bottom: 15px; }
    label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 13px; color: #555; }
    input, textarea, select {
      width: 100%; padding: 12px; border-radius: 12px;
      border: 1px solid #eee; background: #f9f9f9;
      font-family: inherit; margin-bottom: 16px;
      transition: 0.3s; font-size: 14px;
    }
    input:focus, textarea:focus, select:focus { border-color: var(--primary); background: #fff; outline: none; }
    textarea { height: 100px; resize: none; }
    .upload-box {
      border: 2px dashed #ddd; border-radius: 12px;
      padding: 20px; text-align: center; cursor: pointer;
      margin-bottom: 16px; background: #fafafa;
    }
    .upload-icon { font-size: 24px; display: block; margin-bottom: 5px; }
    .upload-text { font-size: 12px; color: #888; }
    input[type="file"] { display: none; }
    .thumbs { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; }
    .thumbs img {
      width: 60px; height: 60px; object-fit: cover;
      border-radius: 10px; border: 1px solid #eee; flex-shrink: 0;
    }
    .btn-save {
      width: 100%; padding: 14px; background: var(--primary);
      color: #fff; border: none; border-radius: 12px;
      font-size: 16px; font-weight: bold; cursor: pointer;
      box-shadow: 0 4px 10px rgba(198,160,71,0.3);
    }
    .btn-save:disabled { background: #ccc; cursor: not-allowed; }
    .product-row {
      display: flex; align-items: center; justify-content: space-between;
      background: #fff; padding: 10px; margin-bottom: 10px;
      border-radius: 12px; border: 1px solid #f0f0f0;
    }
    .p-info { display: flex; align-items: center; gap: 10px; }
    .p-img { width: 40px; height: 40px; border-radius: 8px; object-fit: cover; background: #eee; }
    .p-name { font-size: 14px; font-weight: bold; color: #333; }
    .p-price { font-size: 12px; color: var(--primary); }
    .btn-delete {
      background: #ffe5e5; color: var(--danger);
      border: none; padding: 8px 12px; border-radius: 8px;
      font-size: 12px; font-weight: bold; cursor: pointer;
    }
  </style>
</head>
<body>

<header>
  <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ø³Ø­Ø§Ø¨ÙŠ)</h1>
  <a href="index.html" class="home-link">Ø§Ù„Ù…ØªØ¬Ø± ğŸ </a>
</header>

<div class="container">
  <div class="card">
    <h2>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
    <input type="text" id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬...">
    <label>Ø§Ù„Ø³Ø¹Ø±</label>
    <input type="text" id="price" placeholder="Ù…Ø«Ø§Ù„: 5000">
    <label>Ø§Ù„ØªØµÙ†ÙŠÙ</label>
    <select id="category">
      <option value="Ø£Ø¯ÙˆØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©">Ø£Ø¯ÙˆØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©</option>
      <option value="Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª">Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
    </select>
    <label>ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬</label>
    <div class="upload-box" onclick="document.getElementById('imagesInput').click()">
      <span class="upload-icon">ğŸ“·</span>
      <span class="upload-text">Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±</span>
    </div>
    <input type="file" id="imagesInput" accept="image/*" multiple>
    <div class="thumbs" id="previewBox"></div>
    <label>Ø§Ù„ÙˆØµÙ</label>
    <textarea id="desc" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬..."></textarea>
    <button class="btn-save" onclick="saveProduct()">Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>
  </div>

  <div class="card">
    <h2>ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ± (<span id="count">0</span>)</h2>
    <div id="productsList">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
  </div>
</div>

<script type="module">
  // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…Ù† Ø±ÙˆØ§Ø¨Ø· CDN Ù„ØªØ¹Ù…Ù„ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

  // ğŸ”¥ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© ØªÙ… Ø¯Ù…Ø¬Ù‡Ø§ Ù‡Ù†Ø§
  const firebaseConfig = {
    apiKey: "AIzaSyB5mEBB0plzw_d-gAth-TK0xR523IX6nGg",
    authDomain: "my-fils-575be.firebaseapp.com",
    projectId: "my-fils-575be",
    storageBucket: "my-fils-575be.firebasestorage.app",
    messagingSenderId: "670428095338",
    appId: "1:670428095338:web:75d4a577cc648c208d7b13"
  };

  // ØªÙ‡ÙŠØ¦Ø© ÙØ§ÙŠØ±Ø¨ÙŠØ³
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const productsCol = collection(db, "products"); 

  let selectedImages = [];

  // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±
  document.getElementById("imagesInput").addEventListener("change", function () {
    selectedImages = [];
    document.getElementById("previewBox").innerHTML = "";
    const files = [...this.files];
    if(files.length > 0) document.querySelector('.upload-text').innerText = `ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${files.length} ØµÙˆØ±`;

    files.forEach(file => {
      const reader = new FileReader();
      reader.onload = e => {
        selectedImages.push(e.target.result);
        const img = document.createElement("img");
        img.src = e.target.result;
        document.getElementById("previewBox").appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  });

  // Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬
  window.saveProduct = async function() {
    const name = document.getElementById("name").value.trim();
    const price = document.getElementById("price").value.trim();
    const description = document.getElementById("desc").value.trim();
    const category = document.getElementById("category").value;
    const btn = document.querySelector('.btn-save');

    if (!name || !price) {
      alert("âŒ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ù„Ø³Ø¹Ø±");
      return;
    }

    btn.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹ Ù„Ù„Ø³ÙŠØ±ÙØ±...";
    btn.disabled = true;

    try {
      await addDoc(productsCol, {
        name: name,
        price: price,
        description: description,
        category: category,
        image: selectedImages,
        createdAt: new Date()
      });

      alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!");
      location.reload(); 
      
    } catch (e) {
      console.error("Error adding document: ", e);
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: " + e.message);
      btn.textContent = "Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬";
      btn.disabled = false;
    }
  }

  // Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬
  window.deleteProduct = async function(id) {
    if(!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) return;
    try {
        const btn = document.querySelector(`button[onclick="deleteProduct('${id}')"]`);
        if(btn) btn.textContent = "...";
        
        await deleteDoc(doc(db, "products", id));
        renderProducts(); 
    } catch(e) {
        alert("Ø®Ø·Ø£: " + e.message);
    }
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
  async function renderProducts() {
    const box = document.getElementById("productsList");
    try {
        const snapshot = await getDocs(productsCol);
        box.innerHTML = "";
        document.getElementById("count").textContent = snapshot.docs.length;

        if (snapshot.docs.length === 0) {
            box.innerHTML = "<div style='text-align:center;color:#777;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹</div>";
            return;
        }

        snapshot.docs.forEach(docSnap => {
          const p = docSnap.data();
          const pId = docSnap.id;
          const thumb = Array.isArray(p.image) && p.image.length > 0 ? p.image[0] : '';
          
          const row = document.createElement("div");
          row.className = "product-row";
          row.innerHTML = `
            <div class="p-info">
              <img src="${thumb}" class="p-img">
              <div>
                <div class="p-name">${p.name}</div>
                <div class="p-price">${p.price}</div>
              </div>
            </div>
            <button class="btn-delete" onclick="deleteProduct('${pId}')">Ø­Ø°Ù</button>
          `;
          box.appendChild(row);
        });
    } catch (e) {
        box.innerHTML = `<div style='color:red;text-align:center'>ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase</div>`;
        console.error(e);
    }
  }

  renderProducts();
</script>

</body>
</html>
