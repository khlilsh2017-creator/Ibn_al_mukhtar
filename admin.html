<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #c6a047;
      --bg-color: #f8f9fa;
      --card-bg: #ffffff;
      --text-color: #333;
      --danger: #ff4d4d;
      --success: #4CAF50;
      --warning: #ff9800;
      --aliexpress-red: #FF4747;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      font-family: 'Tajawal', sans-serif;
      background: var(--bg-color); color: var(--text-color);
      margin: 0; padding: 0; padding-top: 70px; padding-bottom: 40px;
    }
    header {
      position: fixed; top: 0; left: 0; right: 0;
      height: 60px; background: #fff;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 100;
    }
    header h1 { margin: 0; font-size: 18px; font-weight: 800; color: var(--primary); }
    .home-link {
      text-decoration: none; font-size: 14px; font-weight: bold; color: #333;
      background: #eee; padding: 6px 12px; border-radius: 20px;
    }
    .container { max-width: 900px; margin: 0 auto; padding: 16px; }
    .card {
      background: var(--card-bg); border-radius: 20px;
      padding: 20px; margin-bottom: 24px;
      border: 1px solid #f0f0f0; box-shadow: 0 4px 15px rgba(0,0,0,0.03);
    }
    h2 { margin-top: 0; font-size: 16px; color: var(--primary); border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; margin-bottom: 15px; }
    
    /* ØªÙ†Ø³ÙŠÙ‚ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
    label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 13px; color: #555; }
    input, textarea, select {
      width: 100%; padding: 12px; border-radius: 12px;
      border: 1px solid #eee; background: #f9f9f9;
      font-family: inherit; margin-bottom: 16px; font-size: 14px;
    }
    .upload-box { border: 2px dashed #ddd; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; margin-bottom: 16px; background: #fafafa; }
    .thumbs { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; }
    .thumbs img { width: 60px; height: 60px; object-fit: cover; border-radius: 10px; border: 1px solid #eee; flex-shrink: 0; }
    .btn-save, .btn-primary { 
        width: 100%; padding: 14px; background: var(--primary); color: #fff; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(198,160,71,0.3); 
    }
    .btn-primary:active, .btn-save:active { opacity: 0.8; }

    /* ØªÙ†Ø³ÙŠÙ‚ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª */
    #categoriesList { margin-top: 15px; }
    .category-item {
        display: flex; justify-content: space-between; align-items: center;
        background: #f0f0f0; padding: 8px 12px; margin-bottom: 8px; border-radius: 8px;
        font-size: 14px; font-weight: 600;
    }
    .btn-cat-delete { background: #fff; color: var(--danger); border: 1px solid var(--danger); padding: 4px 8px; border-radius: 6px; font-size: 11px; cursor: pointer; }
    .cat-input-group { display: flex; gap: 10px; }
    .cat-input-group input { margin-bottom: 0; flex-grow: 1; }
    .cat-input-group button { width: auto; padding: 0 15px; height: 40px; background: var(--success); color: #fff; border: none; border-radius: 12px; }

    /* ØªÙ†Ø³ÙŠÙ‚ Ù‚Ø³Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
    .order-card { border: 2px solid var(--warning); margin-bottom: 20px; padding: 15px; border-radius: 12px; background: #fdfdfd; border-width: 3px; }
    .order-details { font-size: 14px; line-height: 1.6; }
    .client-name { font-size: 16px; font-weight: 800; color: #222; }
    .order-meta { font-size: 12px; color: #777; margin-bottom: 10px; }
    .item-list { font-size: 13px; margin-top: 10px; padding-right: 15px; }
    .total-price { font-size: 16px; font-weight: 800; color: var(--success); margin-top: 10px; }
    .status-badge { background: #ffe0b2; color: var(--warning); padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 700; }
    .no-orders { text-align: center; padding: 40px; color: #999; }
    .action-btn { padding: 8px 15px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 12px; }
    .btn-proof { background: #007bff; color: #fff; } 

    /* Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ÙˆØ§Ù„Ù€ Modal */
    .new-order-alert { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); background: var(--aliexpress-red); color: #fff; padding: 10px 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); font-weight: bold; z-index: 200; display: none; }
    .modal { display: none; position: fixed; z-index: 500; padding-top: 60px; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.9); }
    .modal-content { margin: auto; display: block; width: 90%; max-width: 700px; }
    .close { position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; transition: 0.3s; }
    .close:hover, .close:focus { color: #bbb; text-decoration: none; cursor: pointer; }
    
  </style>
</head>
<body>

<header>
  <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ø³Ø­Ø§Ø¨ÙŠ)</h1>
  <a href="index.html" class="home-link">Ø§Ù„Ù…ØªØ¬Ø± ğŸ </a>
</header>

<div class="container">
  
  <div id="newOrderAlert" class="new-order-alert">ğŸ”” Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ÙˆØµÙ„ Ø§Ù„Ø¢Ù†!</div>
  
  <div class="card" style="border-color:var(--warning);">
    <h2>ğŸ›ï¸ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (<span id="ordersCount">0</span>)</h2>
    <div id="ordersList">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</div>
  </div>

  <div class="card">
    <h2>ğŸ·ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</h2>
    <div class="cat-input-group">
        <input type="text" id="newCategoryName" placeholder="Ø§Ø³Ù… Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù…Ø«Ù„: Ø£Ø¯ÙˆØ§Øª Ù…Ø·Ø¨Ø®)">
        <button onclick="addCategory()">+ Ø¥Ø¶Ø§ÙØ©</button>
    </div>
    <div id="categoriesList">
        </div>
  </div>
  
  <div class="card">
    <h2>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
    <input type="text" id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬...">
    <label>Ø§Ù„Ø³Ø¹Ø±</label>
    <input type="text" id="price" placeholder="Ù…Ø«Ø§Ù„: 5000">
    <label>Ø§Ù„ØªØµÙ†ÙŠÙ</label>
    <select id="categorySelect">
      </select>
    <label>ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬</label>
    <div class="upload-box" onclick="document.getElementById('imagesInput').click()">
      <span class="upload-icon">ğŸ“·</span>
      <span class="upload-text">Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±</span>
    </div>
    <input type="file" id="imagesInput" accept="image/*" multiple>
    <div class="thumbs" id="previewBox"></div>
    <label>Ø§Ù„ÙˆØµÙ</label>
    <textarea id="desc" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬..."></textarea>
    <button class="btn-save" onclick="saveProduct()">Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>
  </div>

  <div class="card">
    <h2>ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
    <p style="font-size: 14px; color: #555; margin-bottom: 15px;">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¹Ø±Ø¶ ÙˆØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø±.</p>
    <a href="products_list.html" class="btn-primary" style="text-align: center; display: block; text-decoration: none;">
        Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    </a>
  </div>

</div>

<div id="proofModal" class="modal" onclick="this.style.display='none'">
  <span class="close">&times;</span>
  <img class="modal-content" id="proofImage">
</div>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";

  // ğŸ”¥ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ (ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ«Ù‡Ø§)
  const firebaseConfig = {
    apiKey: "AIzaSyB5mEBB0plzw_d-gAth-TK0xR523IX6nGg",
    authDomain: "my-fils-575be.firebaseapp.com",
    projectId: "my-fils-575be",
    storageBucket: "my-fils-575be.firebasestorage.app",
    messagingSenderId: "670428095338",
    appId: "1:670428095338:web:75d4a577cc648c208d7b13"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app); 
  
  const productsCol = collection(db, "products"); 
  const ordersCol = collection(db, "orders"); 
  const categoriesCol = collection(db, "categories");

  let selectedFiles = []; 
  let lastOrderCount = 0; 
  let audio = new Audio('https://notificationsounds.com/storage/sounds/file-sounds/26540-bell-ding.mp3');
  let categories = []; 

  // ------------------------------------------------------------------
  // 1. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
  // ------------------------------------------------------------------

  async function fetchCategories() {
      try {
          const snapshot = await getDocs(categoriesCol);
          categories = snapshot.docs.map(doc => ({ id: doc.id, name: doc.data().name }));
          renderCategories();
          updateCategorySelectors();
      } catch (e) {
          console.error("Error fetching categories:", e);
          categories = [
              { id: '1', name: 'Ø£Ø¯ÙˆØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©' },
              { id: '2', name: 'Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª' }
          ];
          renderCategories();
          updateCategorySelectors();
      }
  }

  function renderCategories() {
      const list = document.getElementById("categoriesList");
      list.innerHTML = "";
      if (categories.length === 0) {
          list.innerHTML = "<div style='color:#777;'>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØµÙ†ÙŠÙØ§Øª Ø¨Ø¹Ø¯.</div>";
          return;
      }
      categories.forEach(cat => {
          const item = document.createElement('div');
          item.className = 'category-item';
          item.innerHTML = `
              <span>${cat.name}</span>
              <button class="btn-cat-delete" onclick="deleteCategory('${cat.id}')">Ø­Ø°Ù</button>
          `;
          list.appendChild(item);
      });
  }

  function updateCategorySelectors() {
      const addSelect = document.getElementById('categorySelect');
      
      addSelect.innerHTML = '';

      categories.forEach(cat => {
          const option = new Option(cat.name, cat.name);
          addSelect.appendChild(option.cloneNode(true));
      });
  }

  window.addCategory = async function() {
      const name = document.getElementById('newCategoryName').value.trim();
      if (!name) {
          alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ØªØµÙ†ÙŠÙ Ø£ÙˆÙ„Ø§Ù‹.");
          return;
      }
      if (categories.some(cat => cat.name === name)) {
          alert("Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„.");
          return;
      }

      try {
          await addDoc(categoriesCol, { name: name, createdAt: new Date() });
          document.getElementById('newCategoryName').value = '';
          await fetchCategories();
      } catch (e) {
          alert("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØµÙ†ÙŠÙ: " + e.message);
      }
  }

  window.deleteCategory = async function(id) {
      const catName = categories.find(c => c.id === id)?.name || "Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø­Ø¯Ø¯";
      if(!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ØªØµÙ†ÙŠÙ "${catName}"ØŸ Ø³ÙŠØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªØ§Ø¨Ø¹Ø© Ù„Ù‡ Ù„ÙƒÙ† Ù„Ù† ÙŠØ¸Ù‡Ø± Ø§Ù„ØªØµÙ†ÙŠÙ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.`)) return;

      try {
          await deleteDoc(doc(db, "categories", id));
          await fetchCategories();
      } catch (e) {
          alert("Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªØµÙ†ÙŠÙ: " + e.message);
      }
  }


  // ------------------------------------------------------------------
  // 2. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙÙ‚Ø·)
  // ------------------------------------------------------------------

  document.getElementById("imagesInput").addEventListener("change", function () {
    selectedFiles = [...this.files]; 
    document.getElementById("previewBox").innerHTML = "";

    if(selectedFiles.length > 0) document.querySelector('.upload-box span:last-child').textContent = `ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${selectedFiles.length} ØµÙˆØ±`;

    selectedFiles.forEach(file => {
      const reader = new FileReader();
      reader.onload = e => {
        const img = document.createElement("img");
        img.src = e.target.result;
        document.getElementById("previewBox").appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  });

  window.saveProduct = async function() {
    const name = document.getElementById("name").value.trim();
    const price = document.getElementById("price").value.trim();
    const description = document.getElementById("desc").value.trim();
    const category = document.getElementById("categorySelect").value; 
    const btn = document.querySelector('.btn-save');

    if (!name || !price) {
      alert("âŒ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ù„Ø³Ø¹Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
      return;
    }
    if (selectedFiles.length === 0) { 
        alert("âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬.");
        return;
    }


    btn.textContent = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±..."; 
    btn.disabled = true;
    
    try {
      const imageURLs = [];
      
      // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø¨Ø§Ù„ØªØ³Ù„Ø³Ù„ Ù„Ø¶Ù…Ø§Ù† Ø­ÙØ¸ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨
      for (let i = 0; i < selectedFiles.length; i++) {
          const file = selectedFiles[i];
          
          const fileExtension = file.name.split('.').pop();
          const storagePath = `products_images/${Date.now()}-${i}-${Math.random().toString(36).substring(2)}.${fileExtension}`;
          const storageRef = ref(storage, storagePath);

          await uploadBytes(storageRef, file);
          const url = await getDownloadURL(storageRef);
          imageURLs.push(url); // Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨
          
          btn.textContent = `Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© ${i + 1} Ù…Ù† ${selectedFiles.length}...`;
      }
      
      btn.textContent = "Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬...";
      await addDoc(productsCol, {
        name: name, price: price, description: description, category: category, 
        image: imageURLs, // Ø­ÙØ¸ Ù…ØµÙÙˆÙØ© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø±ØªØ¨Ø©
        createdAt: new Date()
      });
      
      alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!");
      location.reload(); 
    } catch (e) {
      console.error("Error adding document: ", e);
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: " + e.message);
      btn.textContent = "Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬";
      btn.disabled = false;
    }
  }

  // ------------------------------------------------------------------
  // 3. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© + Ø§Ù„Ø§Ø´Ø¹Ø§Ø±Ø§Øª
  // ------------------------------------------------------------------

  async function renderOrders() {
      const box = document.getElementById("ordersList");
      
      try {
          const snapshot = await getDocs(ordersCol); 
          const activeOrders = snapshot.docs.filter(doc => doc.data().orderStatus === 'Ø¬Ø¯ÙŠØ¯');

          if (lastOrderCount > 0 && activeOrders.length > lastOrderCount) {
              triggerAlert(activeOrders.length - lastOrderCount);
          }
          lastOrderCount = activeOrders.length; 
          
          box.innerHTML = "";
          document.getElementById("ordersCount").textContent = activeOrders.length;

          if (activeOrders.length === 0) {
              box.innerHTML = `<div class="no-orders">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</div>`;
              return;
          }

          activeOrders.forEach(docSnap => {
              const order = docSnap.data();
              const orderId = docSnap.id;
              
              const itemsList = order.items.map(item => 
                `<li>${item.name} (Ø¹Ø¯Ø¯: ${item.qty})</li>`
              ).join('');

              let orderDate = order.orderTime ? new Date(order.orderTime).toLocaleString('ar-EG') : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
              
              const showProofBtn = order.paymentProof && order.paymentMethod !== 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…' ? 
                `<button class="action-btn btn-proof" onclick="showProof('${order.paymentProof}')">ğŸ“· Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯ÙØ¹</button>` : '';

              const orderCard = document.createElement('div');
              orderCard.className = 'order-card';
              orderCard.id = `order-${orderId}`;
              
              orderCard.innerHTML = `
                <div class="order-header">
                    <span class="status-badge">Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</span>
                    <span class="order-meta">ØªØ§Ø±ÙŠØ®: ${orderDate}</span>
                </div>
                <div class="order-details">
                    <p class="client-name">${order.clientName}</p>
                    <p>ğŸ“± Ø§Ù„Ø¬ÙˆØ§Ù„: <a href="tel:${order.clientPhone}" style="color:blue;">${order.clientPhone}</a></p>
                    <p>ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${order.clientLocation}</p>
                    
                    <hr style="border:none; border-top:1px dotted #eee; margin: 10px 0;">
                    <p style="font-weight:700;">ğŸ’³ Ø§Ù„Ø¯ÙØ¹: ${order.paymentMethod}</p>
                    
                    <p style="font-weight:700; margin-top:10px;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</p>
                    <ul class="item-list">${itemsList}</ul>
                    
                    <p class="total-price">
                        Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${order.finalTotal.toLocaleString()} Ø±.ÙŠ
                    </p>
                </div>
                <div style="text-align:center; margin-top:15px;">
                    ${showProofBtn}
                    <button class="action-btn" style="background:var(--success); color:#fff; margin-right:10px;" 
                            onclick="markAsProcessed('${orderId}')">
                        âœ… ØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
                    </button>
                    <button class="action-btn" style="background:var(--danger); color:#fff;" 
                            onclick="deleteOrder('${orderId}')">
                        ğŸ—‘ï¸ Ø­Ø°Ù
                    </button>
                </div>
              `;
              box.appendChild(orderCard);
          });

      } catch (e) {
          console.error("Error fetching orders: ", e);
          box.innerHTML = `<div style='color:red;text-align:center'>ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª.</div>`;
      }
  }

  window.showProof = function(base64Image) {
      const modal = document.getElementById("proofModal");
      const image = document.getElementById("proofImage");
      image.src = base64Image;
      modal.style.display = "block";
  }

  function triggerAlert(newCount) {
      audio.play();
      const alertBox = document.getElementById('newOrderAlert');
      alertBox.textContent = `ğŸ”” ÙˆØµÙ„ ${newCount} Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯!`;
      alertBox.style.display = 'block';

      setTimeout(() => {
          alertBox.style.display = 'none';
      }, 5000);
  }

  window.markAsProcessed = async function(id) {
      if(!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø© 'ØªÙ…Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©' Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ")) return;
      try {
          const orderRef = doc(db, "orders", id);
          await updateDoc(orderRef, {
              orderStatus: 'ØªÙ… Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©',
              processedAt: new Date().toISOString()
          });
          renderOrders(); 
      } catch (e) {
          alert("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©: " + e.message);
      }
  }
  
  window.deleteOrder = async function(id) {
       if(!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) return;
       try {
           await deleteDoc(doc(db, "orders", id));
           renderOrders();
       } catch (e) {
           alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù: " + e.message);
       }
  }

  setInterval(renderOrders, 10000); 

  fetchCategories();
  renderOrders();
</script>
</body>
</html>
